# .bit/preflight.aln
modal: .bit.architecture.guard
version: 1.0
description: >
  ALN compliance modal to enforce immutable .bit architecture
  and fail orchestration if nonâ€‘compliant.

triggers:
  - on: workflow.start
    branches: [ main ]

guards:
  - id: check-bit-dir
    type: exists
    path: ".bit"
    fail_message: "âŒ .bit directory missing â€” required for ALN compliance."

  - id: enforce-bit-extension
    type: file_extension
    path: ".bit"
    allowed: [ ".bit" ]
    fail_message: "âŒ Nonâ€‘.bit file detected in .bit architecture modal."

  - id: enforce-authorized-modifications
    type: git_diff
    scope: ".bit/*"
    allowed_authors:
      - "BitBot"
      - "github-actions[bot]"
    fail_message: "âŒ Unauthorized modification to .bit manifests."

  - id: schema-validation
    type: schema
    path: ".bit/**/*.bit"
    schema_ref: ".bit/schema/bit-architecture.json"
    fail_message: "âŒ .bit manifest schema validation failed."

actions:
  on_fail:
    - log: "ğŸ”’ ALN guard triggered â€” blocking orchestration."
    - stop_pipeline: true

  on_pass:
    - log: "âœ… .bit architecture validated under ALN compliance."
