import{R as C,j as t,f as L,U as ds,r as i}from"./vendors-CICR9AUe.js";import{u as O,M as q}from"./i18n-BkEVeW0K.js";import{o3 as oe,A as Ze,m as xe,T as v,$ as et,o4 as us,o5 as ms,o6 as ps,o7 as fs,b as w,b0 as hs,s as De,k as xs,B as G,b_ as ge,al as gs,o as $,o8 as ys,cY as ye,o9 as Ge,fe as bs,z as Ie,h as le,gD as tt,E as ze,a1 as _s,oa as js,di as Oe,dj as re,ob as Ns,ew as vs,f7 as Cs,oc as ie,bE as st,od as Ss,oe as Es,el as fe,of as Ms,og as nt,cL as at,dr as Ue,nV as ot,oh as ws,oi as ks,de as Ts,oj as Rs,e7 as As,af as Ds,ok as Is,ol as rt,om as it,gj as lt,gq as Le,gu as Os,j as Us,on as Ls,ad as He,m_ as $e,oo as Ps,nd as Fs,ao as Bs,nh as Gs,op as z,k4 as zs,oq as Hs}from"./index--pt7q6eW.js";import{T as W,X as ct,u as $s,t as be,cP as Y,f as _e,i as qs,b4 as Ws,f2 as Ys,f3 as Ks,d as dt,ai as Qs,cO as Vs,c as Js,au as Xs,a0 as Zs,aG as en,ec as tn,dA as sn,dB as nn,f4 as qe,f5 as an,dF as We,aJ as on,aL as ve,f6 as Ye,f7 as Ke,f8 as rn,f9 as de,eP as Qe}from"./icons-Babbxpm-.js";import{L as X,l as se,S as Ce}from"./platform-FbNS7mVX.js";import{C as Ve,m as ln,g as cn,E as Se,a as Ee,A as dn,b as un}from"./CodeStep-AXT-wiPY.js";import{C as he}from"./CodeBlock-Bir3ik40.js";import{u as mn}from"./useCometMcpEnabled-C3TlDpn9.js";const Pe=C.memo(e=>{const{isFinished:s,className:o,count:n,showAnimation:c,isPaused:r,...l}=e,a=O(),d=e.action?a.formatMessage(oe[e.action].message):e.title,m=e.action?oe[e.action].icon:e.icon,_=s||r;return t.jsx(Ze,{mode:"popLayout",children:t.jsx(xe.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:c?0:.2,ease:"easeInOut"},className:L("gap-sm group flex cursor-pointer flex-col",o),children:t.jsxs(v,{variant:"tinyRegular",color:s?"light":"super",className:"flex items-center gap-1 py-1.5",children:[m&&t.jsx(W,{icon:m,size:"2xs",className:"-mt-px opacity-80"}),t.jsxs(et,{variant:"super",active:!_,as:"span",speed:"slow",children:[d,n!==void 0&&n>0&&` · ${n}`]})]})},l.key)})});Pe.displayName="StepActionLabel";const ue=(e,s)=>{if(typeof e=="object"&&e!==null&&s in e){const o=e[s];return typeof o=="string"?o:void 0}},pn=(e,s)=>{if(e.step_type!=="MCP_TOOL_INPUT"||s.step_type!=="MCP_TOOL_OUTPUT")return!1;const o=ue(e.content,"goal_id"),n=ue(s.content,"goal_id");if(o&&n)return o===n;const c=ue(e.content,"tool_name"),r=ue(s.content,"tool_name");return!!(c&&r&&c===r)},Vn=e=>{if(!e?.length)return[];if(!e.some(c=>c.step_type==="MCP_TOOL_INPUT"||c.step_type==="MCP_TOOL_OUTPUT"))return e;let o=-1;return e.reduce((c,r,l)=>{if(l<=o||r.step_type==="MCP_TOOL_OUTPUT")return c;const a=e[l+1];return r.step_type==="MCP_TOOL_INPUT"&&a&&pn(r,a)?(c.push({...r,mcp_tool_output_content:a.content}),o=l+1,c):(c.push({...r}),c)},[])},fn=e=>{switch(e){case"notion":return fs;case"linear-direct":return ps;default:return null}},ut=e=>{switch(e){case"notion":return ms;case"linear-direct":return us;default:return ds(e)}},B=C.memo(({icon:e,text:s,favicon:o,className:n,iconClassName:c,url:r})=>{const l=t.jsx(w,{variant:"offset",className:L("py-xs inline-block rounded-lg px-2",{"hover:bg-super group cursor-pointer":r},n),children:t.jsxs(v,{variant:"tinyMono",className:L("gap-x-xs flex pb-px !text-[0.68rem] leading-4",{"group-hover:text-inverse dark:group-hover:text-inverse":r}),children:[(o||e)&&t.jsx("div",{className:"h-4 pt-px",children:o?t.jsx("img",{src:o,alt:s,className:"size-[14px]"}):e?t.jsx(W,{icon:e,size:"xs",className:c}):null}),t.jsx("p",{className:"px-two",children:s})]})});return r?t.jsx(X,{href:r,target:"_blank",rel:"noopener",children:l}):l});B.displayName="BotLabel";const hn=()=>{const{$t:e}=O();return i.useMemo(()=>({success:e({defaultMessage:"Success",id:"xrKHS6mnOh"}),couldNotFinish:e({defaultMessage:"Could not finish",id:"Sz8oY2B0GK"}),allEmail:e({defaultMessage:"All Emails",id:"xe3SFk3aV+"}),allTabs:e({defaultMessage:"All tabs",id:"vYBCIf+wNz"}),failedClosedTabs:e({defaultMessage:"Could not close tabs",id:"hjoQ7gU34V"}),results:e({defaultMessage:"Results",id:"yaMHMBMsQ7"}),continue:e({defaultMessage:"Continue",id:"acrOozm08x"}),skip:e({defaultMessage:"Skip",id:"/4tOwTiCH6"}),foundInfo:e({defaultMessage:"Details retrieved",id:"YCMMMHEIKw"}),allTabGroups:e({defaultMessage:"All tab groups",id:"YL1jEopcqf"}),gmailNotAuthenticated:e({defaultMessage:"Gmail not connected",id:"Zj8MiXlulR"}),googleCalendarNotAuthenticated:e({defaultMessage:"Google Calendar not connected",id:"PH33AilmeW"}),matchesFound:s=>s===0?e({defaultMessage:"No matches found",id:"KeJh7yZCu8"}):e({defaultMessage:"{count, plural, one {One match found} other {# matches found}}",id:"ji6QO7fi7u"},{count:s}),emailsFound:s=>s===0?e({defaultMessage:"No emails found",id:"suW4stNi19"}):e({defaultMessage:"{count, plural, one {# email} other {# emails}}",id:"Rh0ulH+p+5"},{count:s}),eventsFound:s=>s===0?e({defaultMessage:"No events found",id:"GDgEmCHaVM"}):e({defaultMessage:"{count, plural, one {# event} other {# events}}",id:"HhJ8RP7qsx"},{count:s}),availableTimesFound:s=>s===0?e({defaultMessage:"No available times found",id:"2jnY2Ky2Nv"}):e({defaultMessage:"{count, plural, one {# available time} other {# available times}}",id:"5yH+BVFO1f"},{count:s}),selectedContacts:s=>e({defaultMessage:"Selected {count, plural, one {# contact} other {# contacts}}",id:"4kDAeuSFTs"},{count:s}),skippedContacts:e({defaultMessage:"Skipped selecting contacts",id:"IXqYGlHPpF"}),noAvailabilityFound:e({defaultMessage:"No availability",id:"x2vleFRn/L"})}),[e])},xn=async(e,s)=>{try{return await De.POST("/rest/sse/handle_perplexity_blocking_clarifying_answers","blocking-clarifying-questions",{body:{result:{tool_uuid:s,answers:e}}})}catch(o){se.log(o);return}},gn=()=>hs({mutationFn:({answers:e,toolUuid:s})=>xn(e,s)}),mt=C.memo(e=>{const{questions:s,answers:o,toolUuid:n,isFinished:c}=e,{$t:r}=O(),{isMobileStyle:l,isMobileUserAgent:a}=xs(),{mutate:d,isSuccess:m}=gn(),[_,f]=i.useState(()=>o.length===0||o.length!==s.length?s.map(()=>""):[...o]),S=i.useCallback((j,h)=>{f(y=>{const N=[...y];return N[j]=h,N})},[]),g=i.useCallback(()=>{d({answers:_,toolUuid:n})},[_,n,d]);return s.length===0?null:t.jsxs(w,{variant:"offset",className:"p-md rounded-md",children:[s.map((j,h)=>t.jsx(pt,{question:j,index:h,value:_[h],onChange:S,isMobileStyle:l,isMobileUserAgent:a,isDisabled:m||c},h)),t.jsx(G,{extraCSS:"!px-lg mt-md",variant:"primary",text:r({defaultMessage:"Submit",id:"wSZR47Y5kj"}),onClick:g,disabled:c||m,type:"submit"})]})});mt.displayName="BlockingClarifyingQuestions";const pt=C.memo(({question:e,index:s,value:o,onChange:n,isMobileStyle:c,isMobileUserAgent:r,isDisabled:l})=>{const a=i.useCallback(d=>{n(s,d)},[s,n]);return t.jsxs(w,{className:"gap-sm mt-md flex flex-col",children:[t.jsx(v,{variant:"small",children:e}),t.jsx(ge,{value:o,onChange:a,isMobileStyle:c,isMobileUserAgent:r,disabled:l})]},s)});pt.displayName="QuestionInput";const ft=C.memo(({mediaItems:e,className:s})=>{const o=e?.[e?.length-1],n=o?.media_item,c=n?.image||n?.thumbnail,r=i.useMemo(()=>({url:n?.url,name:n?.name}),[n?.name,n?.url]);return o?t.jsxs("div",{className:L("@xs:px-md @xs:pb-md px-sm pb-sm relative flex flex-col gap-1.5",s),children:[t.jsx(Ze,{mode:"wait",children:t.jsx(xe.div,{className:"after:ring-subtler @xs:w-20 md:@xs:w-60 relative overflow-hidden rounded after:pointer-events-none after:absolute after:inset-0 after:rounded-md after:ring-1 after:ring-inset after:ring-opacity-50 md:w-full dark:after:ring-0",initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},transition:{duration:.1,ease:"easeOut"},children:t.jsx(gs,{src:n.thumbnail,lightboxSrc:c,alt:n.name,origin:r,includeLightBoxModal:!0,rounded:!0,imageClassName:"object-cover w-full text-[0] dark:mix-blend-normal",containerClassName:"h-full w-full",maskClassName:"bg-offset"})},n.thumbnail)}),n.url&&t.jsx("div",{children:t.jsx(X,{href:n.url,target:"_blank",children:t.jsx($,{icon:ct,variant:"common",size:"tiny",text:"Open page",extraCSS:"group",iconClassName:"group-hover:text-super",textClassName:"group-hover:text-super font-normal",noPadding:!0})})})]}):null});ft.displayName="StepCardMedia";const je=C.memo(({favicon:e,description:s,title:o,count:n,url:c,media:r,children:l,className:a,showMedia:d=!0,onClick:m,isMissionControlSummary:_})=>{const f=d&&r&&r.length>0;return t.jsxs(w,{variant:"raised",className:L("@container group/step-card relative isolate flex flex-col gap-1.5 overflow-hidden rounded-xl border shadow-sm",a),onClick:m,children:[(o||e)&&t.jsxs("div",{className:L("@xs:px-md px-sm @xs:pt-3 @xs:gap-3 gap-sm flex items-center pt-2"),children:[c&&e?t.jsx(X,{href:c,target:"_blank",rel:"noopener",className:"@xs:size-4 inline-flex size-3 items-center justify-center overflow-hidden rounded",children:e}):e,t.jsxs("div",{className:"@xs:text-sm flex items-baseline text-xs",children:[o&&t.jsx(v,{variant:"tiny",className:"@xs:text-sm",children:o}),n&&t.jsxs("div",{className:"relative flex items-center",children:[t.jsx("span",{className:"px-xs ml-px leading-none opacity-35",children:"·"}),t.jsx(ys,{count:n,className:"opacity-65"})]})]})]}),t.jsxs("div",{className:"@xs:gap-sm @xs:flex-row flex flex-col gap-0",children:[t.jsxs("div",{className:"flex min-w-0 grow flex-col gap-1.5",children:[s&&t.jsx(t.Fragment,{children:_?t.jsx(ht,{description:s}):t.jsx(v,{variant:"tinyRegular",className:"px-md @xs:ml-7 @xs:text-sm ml-4 text-pretty",children:s})}),l]}),f&&t.jsx(ft,{mediaItems:r})]})]})});je.displayName="StepCard";const ht=C.memo(({description:e})=>{const[s,o]=i.useState(!1),{$t:n}=O(),c=i.useCallback(r=>{r.stopPropagation(),o(!s)},[s]);return t.jsxs(v,{variant:"tinyRegular",className:L("px-md mb-sm @xs:text-sm @xs:ml-7 relative ml-4 line-clamp-2 text-pretty",s&&"line-clamp-none"),onClick:c,children:[t.jsxs("span",{className:L("relative",{"select-none":!s}),children:[e,s&&t.jsxs(v,{inline:!0,variant:"tinyRegular",color:"super",className:"select-none opacity-0 group-hover/step-card:opacity-100",children:[" ",n({id:"mFYgAXM/x4",defaultMessage:"Less"})]})]}),!s&&t.jsxs(t.Fragment,{children:[t.jsx(w,{className:"absolute inset-0",variant:"raised",style:{maskImage:"linear-gradient(to bottom, transparent 0%, black 100%)"}}),t.jsx(v,{variant:"tinyRegular",color:"super",className:"right-md bg-raised pl-xs absolute bottom-0 hidden select-none group-hover/step-card:block",children:n({id:"I5NMJ8llIi",defaultMessage:"More"})})]})]})});ht.displayName="ExpandableDescription";const me=20,yn=220,pe=C.memo(({position:e,opacity:s,height:o,offset:n=0})=>t.jsx("div",{className:`dark:from-offset pointer-events-none absolute inset-x-0 from-white to-white/0 dark:to-transparent ${e==="top"?"bg-gradient-to-b":"bottom-0 bg-gradient-to-t"} z-20 backdrop-blur-[0.25px] transition-opacity duration-150`,style:{opacity:s,height:o??(e==="top"?24:16),top:e==="top"?`${n}px`:void 0}}));pe.displayName="ScrollGradient";const ce=C.memo(({children:e,className:s,scrollContainerClassName:o,maxHeight:n=yn,showTopGradient:c=!0,showBottomGradient:r=!0,autoScroll:l=!0,topGradientOffset:a=0})=>{const d=i.useRef(null),[m,_]=i.useState(1),[f,S]=i.useState(0),g=i.useCallback(()=>{const j=d.current;if(!j)return;const h=Math.abs(j.scrollTop),y=Math.max(0,j.scrollHeight-j.clientHeight);l?(_(Math.min(1,Math.max(0,y-h)/me)),S(Math.min(1,h/me))):(_(Math.min(1,h/me)),S(Math.min(1,Math.max(0,y-h)/me)))},[l]);return i.useEffect(()=>{g(),S(1)},[g]),i.useEffect(()=>{const j=d.current;if(j)return j.addEventListener("scroll",g),()=>j.removeEventListener("scroll",g)},[g]),i.useEffect(()=>{g();const j=d.current;if(!j)return;const h=new MutationObserver(g);return h.observe(j,{childList:!0,subtree:!0,characterData:!0}),()=>h.disconnect()},[e,g]),t.jsxs(w,{className:L("relative",s),children:[c&&t.jsxs(t.Fragment,{children:[t.jsx(pe,{position:"top",opacity:m,offset:a}),t.jsx(pe,{position:"top",opacity:m,height:6,offset:a})]}),t.jsx("div",{ref:d,className:L(l?"flex-col-reverse":"flex-col","scrollbar-subtle scrollbar-gutter-stable pb-sm relative flex overflow-y-auto pl-3 pr-1",o),style:{maxHeight:n},children:e}),r&&t.jsx(pe,{position:"bottom",opacity:f})]})});ce.displayName="StepCardScrollableContent";const xt=C.memo(({form_items:e,taskUuid:s})=>{const o=e?.[0]?.text_area_item,n=o?.placeholder,c=o?.text,[r,l]=i.useState(n||""),a="agent-form",d=i.useCallback(async g=>{try{await De.POST("/rest/browser/agent_confirmation",a,{body:{task_uuid:s,status:g,message:r},backOffTime:100,numRetries:2,headers:{"Content-Type":"application/json"}})}catch(j){se.error("Error sending agent confirmation",j)}},[s,r,a]),{$t:m}=O(),_=i.useCallback(g=>{ye.isEnterKeyWithoutShift(g)&&d("accept")},[d]),f=i.useCallback(g=>{g.stopPropagation(),d("accept")},[d]),S=i.useCallback(g=>{g.stopPropagation(),d("reject")},[d]);return t.jsxs(w,{className:"flex flex-col gap-3",children:[t.jsx(v,{color:"light",variant:"small",children:c}),t.jsx(ge,{isMobileStyle:!1,isMobileUserAgent:!1,placeholder:n,value:r,onChange:l,onKeyDown:_}),t.jsxs("div",{className:"gap-sm py-sm flex items-center",children:[t.jsx(G,{size:"small",variant:"inverted",text:m({defaultMessage:"Continue",id:"acrOozm08x"}),type:"submit",disabled:!1,onClick:f}),t.jsx($,{size:"small",text:m({defaultMessage:"Skip",id:"/4tOwTiCH6"}),onClick:S})]})]})});xt.displayName="AgentForm";const bn=1e3,gt=C.memo(({message:e,isFinished:s,isPaused:o})=>{const[n,c]=i.useState(!1),r=i.useRef(e.thought||""),[l,a]=i.useState("working");s=s||e.agent_task_clarification_data?.agent_task_clarification_status===Ge.STOPPED_TASK,o=o||e.agent_task_clarification_data?.agent_task_clarification_status===Ge.PAUSED_TASK,i.useEffect(()=>{if(s){c(!1);return}e.thought!==r.current&&(r.current=e.thought,c(!1));const _=setTimeout(()=>{!s&&!e.action&&c(!0)},bn);return()=>clearTimeout(_)},[e.thought,e.action,s]);const d=!e.action&&!e.thought&&e.url;return i.useEffect(()=>{let _="working";s?_="finished":o?_="paused":d?_="reasoning":n&&!e.action?_="working":e.action&&e.action in oe&&(_=e.action),a(_)},[s,d,n,e.action,o]),!s&&(e.action||d||n&&!e.action)&&t.jsx(Pe,{action:l,isFinished:s,isPaused:o,className:"pl-8"})});gt.displayName="AgentStatusManager";var _n={};const yt=C.memo(({citationUrl:e})=>{const s=i.useCallback(()=>{window.open(e,"_blank","noopener,noreferrer")},[e]);return t.jsx(Ns,{icon:ct,iconClassName:"-ml-px",className:"animate-in fade-in duration-150",size:"extraSmall",textColor:"light",iconOnly:!0,tooltip:"Open page",onClick:s})});yt.displayName="ExternalCitationBubble";const bt=C.memo(({message:e,task:s})=>{const o=e.url||s.start_url,n=e.url?t.jsx(yt,{citationUrl:o}):null;return t.jsx(re,{children:e.thought&&t.jsxs("div",{className:"pl-xs flex gap-3",children:[t.jsx(v,{color:"light",variant:"small",className:"size-4 py-1.5",children:n}),t.jsx(v,{color:"light",variant:"small",className:"py-1.5",children:e.thought})]})})});bt.displayName="MessageItem";const _t=C.memo(({task:e,isFinished:s,isPaused:o})=>{const n=e.agent_messages[e.agent_messages.length-1];return t.jsx(ce,{children:t.jsxs(Oe,{mode:"sync",initial:!1,children:[e.agent_messages.length>0&&e.agent_messages.map((c,r)=>t.jsx(re,{children:t.jsx(bt,{message:c,task:e})},r)),t.jsx(re,{children:t.jsx("div",{children:t.jsx(gt,{message:e.agent_messages.length>0?n:{action:"working",thought:"",url:"",answer:"",uuid:"",value:""},isFinished:s,isPaused:o})})})]})})});_t.displayName="ScrollableContent";const jt=C.memo(({lastMessage:e,taskUuid:s})=>e.form?t.jsx("div",{className:"px-md py-sm ml-7",children:t.jsx(xt,{form_items:e.form.form_items,taskUuid:s})}):null);jt.displayName="FormContent";const ke=C.memo(({task:e,isFinished:s,index:o,isMissionControl:n})=>{const c=e.agent_messages[e.agent_messages.length-1],r=c?.form,l=e.uuid,{taskScreenshots:{[l]:a},tasksState:{[l]:{is_paused:d=!1}={}},taskTabs:m}=Ie(),{$t:_}=O(),f=le(),{result:S}=tt(),g=i.useMemo(()=>m?.some(E=>E.taskUuid===l)??!1,[m,l]),j=i.useMemo(()=>a?[{media_item:{thumbnail:a,image:a,name:_({defaultMessage:"Screenshot",id:"9a+SKtXKhe"})},task_uuid:l,message_uuid:""}]:ze,[_,a,l]),h=i.useMemo(()=>t.jsx(_s,{domain:e.start_url}),[e.start_url]),y=i.useMemo(()=>e.agent_messages.filter(A=>A.screenshot).map(A=>({media_item:{thumbnail:A.screenshot,image:A.screenshot,name:_({defaultMessage:"Screenshot",id:"9a+SKtXKhe"})},task_uuid:e.uuid,message_uuid:""})),[_,e.uuid,e.agent_messages]),N=i.useMemo(()=>r?ze:e.media&&e.media.length?e.media:y.length?y:j,[r,y,j,e.media]),k=i.useCallback(async E=>{if(E.stopPropagation(),s)if(n){if(!g)return}else return;_n.NEXT_PUBLIC_IS_SIDECAR_BUILD?await f.makeTaskVisible(l):f.moveThreadToSidecar(l,n,S?.backend_uuid)},[f,l,s,n,g,S?.backend_uuid]),D=n&&s;return t.jsx(je,{favicon:h,title:js(e.start_url),media:N,description:e.task,showMedia:!r,onClick:k,className:"hover:border-super cursor-pointer",isMissionControlSummary:D,children:D?null:r&&c&&!s?t.jsx(jt,{lastMessage:c,taskUuid:e.uuid}):t.jsx(_t,{task:e,isFinished:s,isPaused:d})},o)});ke.displayName="TaskStep";const Nt=C.memo(({step:e,isFinished:s,isMissionControl:o})=>t.jsx(jn,{tasks:e.content.tasks,isMissionControl:o,isFinished:s})),jn=({tasks:e,isMissionControl:s,isFinished:o})=>s&&o&&e.length>1?t.jsx("div",{className:"-mx-sm",children:t.jsx(bs,{orientation:"horizontal",viewportClassName:"px-sm",children:t.jsxs(w,{className:"gap-sm flex flex-row",children:[e.map((c,r)=>t.jsx("div",{className:"w-3/4 shrink-0",children:t.jsx(ke,{task:c,isFinished:o,index:r,isMissionControl:s})},r)),t.jsx("div",{className:"w-px shrink-0"})]})})}):t.jsx(w,{className:"gap-y-md flex flex-col",children:e.map((c,r)=>t.jsx(ke,{task:c,isFinished:o,index:r,isMissionControl:s},r))});Nt.displayName="BrowserStep";const vt=C.memo(({disabled:e,onClick:s})=>t.jsx(G,{disabled:e,onClick:s,icon:$s,variant:"common",size:"small"}));vt.displayName="CardPaginationPrevious";const Ct=C.memo(({disabled:e,onClick:s})=>t.jsx(G,{disabled:e,onClick:s,icon:be,variant:"common",size:"small"}));Ct.displayName="CardPaginationNext";const St=C.memo(({operation:e,isShowEditableComponentsEnabled:s,buttonVariant:o,buttonText:n,onConfirm:c,onSkip:r})=>{const{$t:l}=O(),[a,d]=i.useState();i.useEffect(()=>{d(void 0)},[e]);const m=i.useMemo(()=>{if(e?.update){const h=e.update.event,y=e.update.new_event;return h&&y?{...h,...Object.fromEntries(Object.entries(y).filter(([k,D])=>D!==null))}:y||h}return e?.add?.event||e?.delete?.event},[e]),_=i.useCallback(h=>{d(h)},[]),f=i.useCallback(h=>[{...e,...h&&{...e.add&&{add:{event:h}},...e.update&&{update:{event:h}},...e.delete&&{delete:{event:h,delete_scope:e.delete?.delete_scope}}},status:h.status.toUpperCase()}],[e]),S=i.useCallback((h,y)=>{const N=y||{...a||m,status:h};return{confirmed:!0,operations:N?f(N):[]}},[a,m,f]),g=i.useCallback(()=>{let h="CREATED";e.update?h="UPDATED":e.delete&&(h="DELETED"),c(S(h))},[S,c,e]),j=i.useCallback(()=>{r(S("REJECTED"))},[S,r]);return t.jsxs(t.Fragment,{children:[m&&e.delete&&t.jsx(w,{className:"px-sm mb-sm",children:t.jsx(Ve,{event:m,newEvent:e.update?.new_event,isEditable:!1})}),m&&!e.delete&&t.jsx(w,{className:"px-md py-sm",children:t.jsx(Ve,{event:m,newEvent:e.update?.new_event,onEventChange:_,isEditable:s})}),t.jsx("form",{onSubmit:h=>{h.preventDefault(),g()},children:t.jsx(w,{className:"px-md py-sm gap-4 border-t pt-4",children:t.jsx("div",{className:"gap-sm flex items-center justify-between",children:t.jsxs("div",{className:"gap-sm flex items-center",children:[t.jsx(G,{size:"small",variant:o,text:n,type:"submit"}),t.jsx($,{size:"small",text:l({defaultMessage:"Skip",id:"/4tOwTiCH6"}),onClick:j})]})})})})]})});St.displayName="CalendarOperationItem";function Nn(){const{value:e}=vs({flag:"show-editable-calendar-components",defaultValue:!1});return e}const vn=({result:e,isDeleteOperation:s})=>{const{$t:o}=O();return e?.confirmed===!0?t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(Y,{size:14,className:"shrink-0 text-[#16a34a]",title:"Confirmed"}),t.jsx("span",{className:"text-xs font-medium leading-none text-[#16a34a]",children:o(s?{defaultMessage:"Deleted",id:"KQvWvDRI1B"}:{defaultMessage:"Accepted",id:"aFyFm0PsCy"})})]}):e?.confirmed===!1?t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(_e,{size:14,className:"text-negative shrink-0",title:"Skipped"}),t.jsx("span",{className:"text-negative text-xs font-medium leading-none",children:o({defaultMessage:"Skipped",id:"djZCU5enGS"})})]}):null},Et=C.memo(({calendarOperations:e,sendStepResult:s,isFinished:o})=>{const n="calendar-operation-step",[c,r]=i.useState(o??!1),{$t:l}=O(),a=Nn(),[d,m]=i.useState(0),[_,f]=i.useState(()=>Array(e.length).fill(null)),S=i.useRef(!1),g=i.useMemo(()=>e[d],[e,d]),j=i.useMemo(()=>g?.delete?.event?"rejected":"inverted",[g?.delete?.event]),h=i.useMemo(()=>g?g.delete?.event?l({defaultMessage:"Delete",id:"K3r6DQW7h+"}):l({defaultMessage:"Schedule",id:"hGQqkWwmJD"}):l({defaultMessage:"Schedule",id:"hGQqkWwmJD"}),[g,l]),y=e.length>1,N=i.useMemo(()=>({position:"absolute",bottom:16,right:16,zIndex:10}),[]),k=i.useCallback(()=>{m(R=>Math.max(R-1,0))},[]),D=i.useCallback(()=>{m(R=>Math.min(R+1,e.length-1))},[e.length]),E=i.useCallback(R=>{f(u=>{const M=[...u];M[d]=R;const I=M.findIndex(K=>K===null);if(M.every(K=>K!==null)&&!S.current){S.current=!0;const K=M.map(U=>U?.operations).filter(U=>Array.isArray(U)).flat();K.length>0?s({confirmed:!0,operations:K},n,!1):s({confirmed:!1},n,!1),r(!0)}else I!==-1&&m(I);return M})},[d,s,n]),A=i.useCallback(R=>{E(R)},[E]);return c?t.jsx(B,{icon:Y,iconClassName:"text-super",text:l({defaultMessage:"Done",id:"JXdbo8Vnlw"})}):g?t.jsxs(w,{variant:"raised",className:"py-sm relative rounded-lg border",children:[t.jsx(St,{operation:JSON.parse(JSON.stringify(g)),isShowEditableComponentsEnabled:a,buttonVariant:j,buttonText:h,onConfirm:E,onSkip:A},`operation-${d}`),y&&t.jsxs(w,{style:N,className:"flex items-center gap-4",children:[t.jsx(vn,{result:_[d],isDeleteOperation:!!g?.delete?.event}),t.jsxs("span",{className:"text-xs font-medium",children:[t.jsx("span",{className:"text-foreground",children:d+1}),t.jsxs("span",{children:[" of ",e.length]})]}),t.jsxs(w,{className:"flex gap-2",children:[t.jsx(vt,{disabled:d===0,onClick:k}),t.jsx(Ct,{disabled:d===e.length-1,onClick:D})]})]})]}):t.jsx(w,{variant:"raised",className:"py-sm relative rounded-lg border",children:t.jsx("div",{className:"p-4 text-center",children:l({defaultMessage:"No calendar operation available",id:"Hm6yv1Uz2P"})})})});Et.displayName="CalendarOperationStep";const ae=.03,Cn=3,Z=C.memo(({items:e,initialDisplayCount:s=Cn,stepDelay:o=ae,isFinished:n=!1,vertical:c=!1,truncate:r=!0,onCountChange:l})=>{const[a,d]=i.useState([]),[m,_]=i.useState(!1),f=i.useRef(null),S=i.useRef(!0),g=i.useRef(n),j=i.useRef(0);i.useEffect(()=>()=>{f.current&&clearTimeout(f.current)},[]),i.useEffect(()=>{if(l){const R=r&&(o!==ae?n&&a.length<e.length:a.length<e.length)?e.length:a.length;l(R)}},[a.length,e.length,n,o,r,l]),i.useEffect(()=>{const E=r?s:e.length;if(S.current)if(S.current=!1,e.length>0)if(n){const R=Math.min(E,e.length);d(e.slice(0,R)),j.current=R}else d([e[0]]),j.current=1;else d([]),j.current=0;if(m){d(e),j.current=e.length;return}if(n&&!g.current&&(f.current&&(clearTimeout(f.current),f.current=null),d(()=>{const R=Math.min(E,e.length),u=e.slice(0,R);return j.current=u.length,u})),g.current=n,f.current&&(clearTimeout(f.current),f.current=null),j.current>=E||j.current>=e.length)return;const A=()=>{let R=0;if(d(u=>u.length<e.length&&u.length<E?(R=u.length+1,j.current=R,[...u,e[u.length]]):(R=u.length,j.current=R,u)),R<e.length&&R<E){const u=n?ae:o;f.current=setTimeout(A,u*1e3)}};if(j.current>0){const R=n?ae:o;f.current=setTimeout(A,R*1e3)}else e.length>0&&(d([e[0]]),j.current=1)},[e,s,o,n,m,r]);const h={initial:{opacity:0,x:-3},animate:{opacity:1,x:0}},y=()=>{_(!0)},k=r&&(o!==ae?n&&a.length<e.length:a.length<e.length),D=i.useCallback(E=>{E.stopPropagation(),y()},[]);return t.jsxs("div",{className:`flex items-center ${c?"flex-col items-start gap-px":"gap-sm flex-wrap"}`,children:[a.map((E,A)=>t.jsx(xe.div,{className:c?"w-full":"inline-flex",variants:h,initial:"initial",animate:"animate",transition:{duration:.1,ease:Cs},children:E},A)),k&&t.jsx(w,{variant:"offset",bgHover:"offsetPlus",className:"py-xs cursor-pointer rounded-lg px-2.5",onClick:D,children:t.jsx(v,{variant:"tinyMono",className:"!text-[0.68rem]",children:t.jsx(q,{defaultMessage:"+{count} more",id:"/zFGgPmQSV",values:{count:e.length-a.length}})})})]})});Z.displayName="ResultsRenderer";const H=C.memo(({queries:e,icon:s=qs,stepDelay:o,isFinished:n,initialDisplayCount:c=12,enableQueryLinks:r=!1})=>{const l=e.map((a,d)=>t.jsx(B,{icon:s,text:a,url:r?`/search/new?q=${encodeURIComponent(a)}`:void 0},d));return t.jsx("div",{className:"gap-sm flex flex-wrap",children:t.jsx(Z,{items:l,initialDisplayCount:c,stepDelay:o,isFinished:n})})});H.displayName="SearchWebStep";const Mt=C.memo(({operations:e})=>{const{$t:s,formatMessage:o}=O(),n=i.useMemo(()=>{const l={created:0,updated:0,deleted:0,rejected:0};return e.forEach(a=>{switch(a.status?.toUpperCase()){case"CREATED":l.created++;break;case"UPDATED":l.updated++;break;case"DELETED":l.deleted++;break;case"REJECTED":l.rejected++;break}}),l},[e]),c=i.useMemo(()=>{const l=[];return n.created>0&&l.push({count:n.created,label:s({defaultMessage:"Created",id:"ORGv1Q6rL/"})}),n.updated>0&&l.push({count:n.updated,label:s({defaultMessage:"Updated",id:"xrk6zgu9jU"})}),n.deleted>0&&l.push({count:n.deleted,label:s({defaultMessage:"Deleted",id:"KQvWvDRI1B"})}),n.rejected>0&&l.push({count:n.rejected,label:s({defaultMessage:"Rejected",id:"5qaD7sDVxu"})}),l},[n,s]),r=i.useMemo(()=>c.length===0?[]:[c.map(l=>o({defaultMessage:"{count} {status}",id:"e6QlErEcyz"},{count:l.count,status:l.label})).join(", ")],[c,o]);return r.length===0?null:t.jsx(H,{icon:Ws,queries:r})});Mt.displayName="CalendarStatusSummary";const wt=C.memo(({step:e})=>{const s=e.content.clarification;return s?t.jsx("div",{className:"gap-sm flex flex-row",children:t.jsx(B,{icon:Ys,text:s})}):null});wt.displayName="ClarificationStep";const kt=C.memo(({status:e})=>{const{$t:s}=O();let o=Y,n=s({defaultMessage:"Done",id:"JXdbo8Vnlw"});switch(e){case"SENT":o=Y,n=s({defaultMessage:"Email sent",id:"as7ksh6tP3"});break;case"FORWARDED":o=Ks,n=s({defaultMessage:"Email forwarded",id:"QUWo2L2sfE"});break;case"REJECTED":o=_e,n=s({defaultMessage:"Email rejected",id:"+469cQAaqI"});break;default:o=Y,n=s({defaultMessage:"Done",id:"JXdbo8Vnlw"});break}return t.jsx(B,{icon:o,iconClassName:"text-super",text:n})});kt.displayName="EmailStatusStep";const Tt=C.memo(({onClick:e,urls:s})=>{const o=i.useMemo(()=>s.map(n=>t.jsx(Rt,{url:n,onClick:e},n)),[e,s]);return t.jsx("div",{className:"gap-sm flex flex-wrap",children:t.jsx(Z,{items:o,initialDisplayCount:1})})});Tt.displayName="GeneratedImageResultsStep";const Rt=C.memo(({url:e,onClick:s})=>{const o=i.useCallback(()=>{s?.(e)},[e,s]);return t.jsx(X,{className:"block",href:e,target:"_blank",rel:"noopener nofollow",onClick:o,children:t.jsx(w,{variant:"offset",bgHover:"offsetPlus",className:"py-xs rounded-lg pl-1.5 pr-2.5",children:t.jsx(ie,{variant:"tinyMono",className:"!text-[0.7rem]",url:e,isAttachment:!1,connectionType:st.GENERATED_IMAGE,source:"Generated Image"})})},e)});Rt.displayName="LinkFactory";const At=C.memo(({onClick:e,urls:s})=>{const o=i.useMemo(()=>s.map(n=>t.jsx(Dt,{url:n,onClick:e},n)),[e,s]);return t.jsx("div",{className:"gap-sm flex flex-wrap",children:t.jsx(Z,{items:o,initialDisplayCount:1})})});At.displayName="GeneratedVideoResultsStep";const Dt=C.memo(({url:e,onClick:s})=>{const o=i.useCallback(()=>{s?.(e)},[e,s]);return t.jsx(X,{className:"block",href:e,target:"_blank",rel:"noopener nofollow",onClick:o,children:t.jsx(w,{variant:"offset",bgHover:"offsetPlus",className:"py-xs rounded-lg pl-1.5 pr-2.5",children:t.jsx(ie,{variant:"tinyMono",className:"!text-[0.7rem]",url:e,isAttachment:!1,connectionType:st.GENERATED_VIDEO,source:"Generated Video"})})},e)});Dt.displayName="LinkFactory";const Te=C.memo(({color:e,title:s})=>{const o="bg-[#13343B] dark:bg-[#F5F5F5]",c=(r=>r?{red:"bg-[#C0152F] dark:bg-[#FF5459]",maroon:"bg-[#944454] dark:bg-[#B3C901]",orange:"bg-[#DB7100] dark:bg-[#FFAB44]",teal:"bg-[#21808D] dark:bg-[#32B8C6]",grey:o,brown:"bg-[#A84B2F] dark:bg-[#E68161]",green:"bg-[#848456] dark:bg-[#B4B662]",gold:"bg-[#D39900] dark:bg-[#F0B435]",purple:"bg-[#865D95] dark:bg-[#C48ED8]",blue:"bg-[#19789E] dark:bg-[#54B4E3]"}[r]??o:o)(e);return t.jsx("div",{className:L("py-xs w-fit rounded-md px-2.5",c),children:t.jsx(v,{className:"translate-y-half",variant:"tiny",color:"defaultInverted",children:s})})});Te.displayName="GroupingTabsStep";const Sn=async({uuid:e,content:s,isError:o=!1})=>{await De.POST("/rest/sse/perplexity_mcp_response","local-mcp-step",{body:{result:{content:s,is_error:o,uuid:e}}})},It=C.memo(e=>{const{step:s,server:o,isFinished:n}=e,{$t:c}=O(),[r,l]=i.useState(!1),[a,d]=i.useState(!1),m=le(),{mcpTools:_,installedDxts:f}=Ie(),{data:S}=Ss(),{tool_id:g,tool_name:j,tool_args:h}=s.content,y=s.mcp_tool_output_content,N=o.name,D=i.useMemo(()=>_?.find(({id:U})=>U===g)?.tool,[_,g])?.description,E=i.useMemo(()=>o.dxt_name?f?.find(({name:U})=>U===o.dxt_name):null,[f,o.dxt_name]),A=i.useCallback(async U=>{if(s.uuid){d(!0),l(!1);try{await Sn({...U,uuid:s.uuid})}finally{d(!1)}}},[s.uuid]),R=i.useCallback(async()=>{if(!(!N||!j||!s.uuid)){d(!0);try{const U=await m.callMcpTool({mcpServerName:N,toolName:j,toolArgs:h},{step_uuid:s.uuid});await A({content:U.content.map(J=>J.text).filter(Boolean).join(`

`)})}catch(U){await A({content:`The MCP tool call failed: ${U instanceof Error?U.message:"Unknown error"}`,isError:!0})}finally{d(!1)}}},[m,A,N,j,h,s.uuid]),u=i.useCallback(()=>{R()},[R]),M=i.useCallback(()=>{A({content:'The MCP tool call was rejected by the user (refer to them as "you" or use the appropriate equivalent in their language when mentioning this)'})},[A]),I=i.useCallback(()=>{l(U=>!U)},[]),P=E?.manifest.display_name??E?.manifest.name??N,K=i.useMemo(()=>{if(o.dxt_name)return S?.find(({id:U})=>U===o.dxt_name)?.icon_url},[o.dxt_name,S]);return t.jsxs(w,{variant:"background",className:"rounded-lg border p-6",children:[t.jsxs("div",{className:"mb-6 flex items-center gap-2",children:[t.jsx(w,{variant:"superLight",className:"text-super flex size-12 items-center justify-center rounded-lg",children:t.jsx(Es,{serverName:P,iconUrl:K,size:"lg"})}),t.jsx("div",{className:"flex-1",children:t.jsx(v,{variant:"base",className:"font-medium",children:n?t.jsx(q,{defaultMessage:'Perplexity asked to use a tool from "{mcpServerName}" MCP-server',id:"gNLYcmUanW",values:{mcpServerName:P}}):t.jsx(q,{defaultMessage:'Allow Perplexity to use a tool from "{mcpServerName}" MCP-server?',id:"Bi84hx6i2G",values:{mcpServerName:P}})})})]}),t.jsxs(w,{className:"mb-6 rounded-lg border",children:[t.jsxs("div",{className:"flex cursor-pointer items-center justify-between p-4",onClick:I,children:[t.jsxs("div",{className:"flex-1",children:[t.jsx(v,{variant:"smallMono",className:"font-medium",children:j}),t.jsx(v,{variant:"small",color:"light",className:"mt-1",children:D})]}),t.jsx(be,{size:20,className:`text-quiet transition-transform ${r?"rotate-90":""}`})]}),r&&t.jsxs(w,{variant:"offsetPlus",className:"border-t p-4",noBorder:!1,children:[t.jsx(v,{variant:"smallMono",className:"mb-2 font-medium",children:t.jsx(q,{defaultMessage:"Request",id:"p1P+hQq6tY"})}),t.jsx(w,{variant:"background",className:"rounded",children:t.jsx("pre",{className:"overflow-x-auto whitespace-pre-wrap p-3 font-mono text-sm",children:JSON.stringify(h,null,2)})}),y&&t.jsxs(t.Fragment,{children:[t.jsx(v,{variant:"smallMono",className:L("mb-2 mt-4 font-medium",y.status!=="success"&&"text-negative"),children:y.status==="success"?t.jsx(q,{defaultMessage:"Success response",id:"W0CiIRCQq9"}):t.jsx(q,{defaultMessage:"Error response",id:"iGtVGGoWIl"})}),t.jsx(w,{variant:"background",className:"rounded",children:t.jsx("pre",{className:"overflow-x-auto whitespace-pre-wrap p-3 font-mono text-sm",children:JSON.stringify(y.content,null,2)})})]})]})]}),!n&&t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("div",{className:"flex items-center gap-2",children:t.jsx(G,{variant:"primary",size:"regular",disabled:a,text:c({defaultMessage:"Allow",id:"y/bmsG8rnv"}),onClick:u})}),t.jsx(G,{variant:"border",size:"regular",disabled:a,text:c({defaultMessage:"Reject",id:"VzIOKf1uNn"}),onClick:M})]})]})});It.displayName="LocalMcpStep";const En=e=>e?e.toLowerCase().replace(/[\s-]/g,"_").replace(/([a-z])([A-Z])/g,"$1_$2").replace(/^_+|_+$/g,"").replace(/_+/g,"_"):"",Ot=C.memo(({tool_logo_url:e,app:s,merge_extra_args:o,step_uuid:n,backend_uuid:c})=>{const{$t:r}=O(),l=En(s||""),a=i.useCallback(async()=>{await Ms({uuid:n,success:!1,reason:"User skipped authentication"})},[n]),d=i.useMemo(()=>({name:"mcp_connector_auth",upsell_type:"CONNECT_TO_CONNECTOR",app_location:"UPSELL_APP_LOCATION_UNSPECIFIED",title:r({defaultMessage:"Connect your {appName} account",id:"YPjv1DRLLL"},{appName:l}),description:r({defaultMessage:"Connect your {appName} account to get started",id:"MtMLxu8Eaj"},{appName:l}),cta:"MERGE_AUTH_CONNECTOR",icon_reference:l,...e&&{icon_image:{url:e,alt:l}},button_color:"INVERTED",button_text:"Connect",cta_information:{merge_auth_token:o?.auth_info?.auth_token,merge_auth_callback_uuid:n},show_in_comet:!0,is_persistent:!0,backend_uuid:c,image_asset:"",background_super:!1}),[l,c,e,r,o?.auth_info?.auth_token,n]);return t.jsx(nt,{position:"router_steps",upsellInformation:d,backendUuid:c,isLastResult:!0,hideOnAccept:!1,hideOnReject:!1,onReject:a})});Ot.displayName="UnauthenticatedMcpToolInput";const Mn={language:"json"},Ut=C.memo(e=>{const{tool_args:s,tool_name:o}=e,[n,c]=i.useState(!1),r=i.useCallback(()=>c(l=>!l),[]);return t.jsx(w,{className:"border-subtlest p-sm rounded-lg border",children:!!(s&&typeof s=="object"&&s!==null)&&t.jsxs(w,{className:"border-subtlest p-sm rounded-lg border",children:[t.jsxs(w,{className:"flex items-center justify-between",children:[t.jsx(v,{variant:"smallMono",children:o}),t.jsx($,{size:"small",icon:n?dt:be,onClick:r})]}),t.jsx(Oe,{mode:"popLayout",transition:{duration:.2,ease:fe},children:n&&t.jsx(re,{initial:{opacity:0,y:-5},animate:{opacity:1,y:0},exit:{opacity:0,y:-5},transition:{duration:.15,ease:fe},children:t.jsxs(w,{className:"mt-sm rounded-lg",variant:"offset",children:[t.jsx(v,{variant:"tiny",className:"p-md pb-0",children:t.jsx(q,{defaultMessage:"Request",id:"p1P+hQq6tY"})}),t.jsx(he,{className:"scrollbar-subtle my-0 max-h-[200px] overflow-y-auto text-xs",codeBlockProps:Mn,hideCopy:!0,hideLanguage:!0,children:s&&typeof s=="object"?JSON.stringify(s):"No instructions"})]})})})]})})});Ut.displayName="AuthenticatedMcpToolInput";const Lt=C.memo(e=>{const{authenticated:s}=e;return s?t.jsx(Ut,{...e}):t.jsx(Ot,{...e})});Lt.displayName="McpToolInput";function Pt(e){return JSON.stringify(e,null,2)}const Ft=(e,s=1e4,{showTruncationIndicator:o=!0,format:n=!1}={})=>{if(e.length<=s)return n?Bt(e):e;let c=s;const r=Math.max(0,s-100);for(let d=s-1;d>=r;d--){const m=e[d];if(m===","||m===`
`||m===" "||m==="	"){c=d;break}}const l=e.substring(0,c).trim(),a=n?wn(e,l):l;if(o){const d=`

// Content truncated at ${c} characters (original: ${e.length} chars)`;return a+d}return a};function Bt(e){try{return Pt(JSON.parse(e))}catch{return e}}function wn(e,s){const o=Bt(e),n=s.replace(/\s/g,"").length;let c=0,r=o;for(let a=0;a<o.length;a++)/\s/.test(o[a])||(c++,c===n&&(r=o.substring(0,a+1)));const l=s.at(-1);for(let a=r.length-1;a>=0;a--)if(r[a]===l){r=r.substring(0,a+1);break}return r}const Je={language:"json"},Me=2e3,Gt=C.memo(({step:e,isFinished:s})=>{const{formatNumber:o}=O(),{lastResult:n}=at(),{submitQuery:c}=Ue(),r=e.content,l=e.mcp_tool_output_content,[a,d]=i.useState(!1),m=i.useMemo(()=>!!l?.should_rerun_query,[l]),_=i.useCallback(async()=>{n?.query_str&&(await ot({entryUUID:n.backend_uuid,reason:"mcp-tool-output-merge-api"}),c({rawQuery:n.query_str,existingEntryUUID:n.backend_uuid,redoSearch:!0,collection:null,newFrontendContextUUID:null,existingFrontendContextUUID:n.frontend_context_uuid,promptSource:"user",querySource:"mcp-tool-input",attachments:[],modelPreferenceOverride:"pplx_pro",sourcesOverride:ws(n.sources?.sources)}))},[c,n]);i.useEffect(()=>{m&&_()},[_,m]);const f=i.useCallback(()=>d(D=>!D),[]),S=i.useMemo(()=>l?.content?Ft(l.content,Me,{showTruncationIndicator:!1,format:!0}):"",[l?.content]),g=Ie(),j=mn(),h=i.useMemo(()=>{if(!j)return null;const[D,E]=r.tool_id?.split(ks)??[];return!D||!E?null:g.mcpStdioServers?.find(A=>A.name===D)},[j,r.tool_id,g.mcpStdioServers]);if(h)return t.jsx(It,{server:h,step:e,isFinished:s});if(r.authenticated===void 0||r.authenticated===null)return null;const y=r.authenticated===!0,N=r.logo_url||fn(r.app||""),k=ut(r.app||"");return y?t.jsxs(w,{className:"p-sm grid grid-cols-[max-content_1fr] gap-x-2 rounded-lg border pl-4",children:[t.jsxs("div",{className:"col-span-full grid grid-cols-subgrid items-center",children:[N&&t.jsx("img",{src:N,alt:`${r.app} Logo`,className:"size-4 rounded object-cover"}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(v,{variant:"smallBold",children:k}),t.jsx("div",{className:"ml-auto flex items-center gap-2",children:t.jsx($,{size:"small",icon:a?dt:be,onClick:f})})]})]}),t.jsx("div",{className:"col-start-2 col-end-3 min-w-0",children:t.jsx(Oe,{mode:"popLayout",initial:!1,transition:{duration:.2,ease:fe},children:a&&t.jsx(re,{initial:{opacity:0,y:-5},animate:{opacity:1,y:0},exit:{opacity:0,y:-5},transition:{duration:.15,ease:fe},children:t.jsx("div",{className:"mt-sm",children:t.jsx(ce,{maxHeight:400,autoScroll:!1,scrollContainerClassName:"scrollbar-subtle !pl-0",showTopGradient:!1,showBottomGradient:!1,children:t.jsxs("div",{className:"flex flex-col gap-2",children:[t.jsx(v,{variant:"tinyMono",children:r.tool_name}),!!(r.tool_args&&typeof r.tool_args=="object"&&r.tool_args!==null)&&t.jsxs(w,{className:"rounded-lg pb-1",variant:"offset",children:[t.jsx(v,{variant:"tiny",className:"p-md pb-0",children:t.jsx(q,{defaultMessage:"Request",id:"J+m4xH5bwC",description:"Request"})}),t.jsx(he,{className:"my-0 text-xs",codeBlockProps:Je,hideCopy:!0,hideLanguage:!0,children:r.tool_args&&typeof r.tool_args=="object"?Pt(r.tool_args):"No instructions"})]}),l&&t.jsxs(w,{variant:"offset",className:"rounded-lg",children:[t.jsx(v,{variant:"tiny",className:"p-md pb-0",children:t.jsx(q,{defaultMessage:"Response",id:"UC/2Eq4W+h",description:"Response"})}),t.jsx(he,{className:"my-0 text-xs",codeBlockProps:Je,hideCopy:!0,hideLanguage:!0,children:S}),l.content&&l.content.length>Me&&t.jsx("div",{className:"flex items-center justify-center rounded-b bg-[#f9fafb] p-2 dark:bg-[#1f2937]",children:t.jsx(v,{variant:"tiny",color:"light",children:t.jsx(q,{defaultMessage:"Content truncated at {truncatedSize} (original size: {originalSize})",id:"ipA00V5aGw",values:{truncatedSize:o(Me/1024,{maximumFractionDigits:0,style:"unit",unit:"kilobyte",unitDisplay:"narrow"}),originalSize:o(l.content.length/1024,{maximumFractionDigits:0,style:"unit",unit:"kilobyte",unitDisplay:"narrow"})}})})})]})]})})})})})})]}):t.jsx(Lt,{...r,step_uuid:e.uuid??"",backend_uuid:n?.backend_uuid??"",authenticated:y,tool_args:r.tool_args,tool_logo_url:N??void 0})});Gt.displayName="McpInputOutputStep";const kn={language:"json"},we=2e3,zt=C.memo(e=>{const{content:s,shouldRerunQuery:o=!1}=e,{lastResult:n}=at(),{submitQuery:c}=Ue(),r=i.useMemo(()=>Ft(s,we),[s]),l=i.useCallback(async()=>{n?.query_str&&(await ot({entryUUID:n.backend_uuid,reason:"mcp-tool-output-merge-api"}),c({rawQuery:n.query_str,existingEntryUUID:n.backend_uuid,redoSearch:!0,collection:null,newFrontendContextUUID:null,existingFrontendContextUUID:n.frontend_context_uuid,promptSource:"user",querySource:"mcp-tool-input",attachments:[],modelPreferenceOverride:"pplx_pro"}))},[c,n]);return i.useEffect(()=>{o&&l()},[l,o]),t.jsx(w,{className:"border-subtlest p-sm rounded-lg border",children:t.jsxs(w,{className:"flex flex-col rounded-lg",variant:"offset",children:[t.jsx(v,{variant:"tiny",className:"p-md pb-0",children:t.jsx(q,{defaultMessage:"Response",id:"MgdnPiJHcj"})}),t.jsx(he,{className:"scrollbar-subtle my-0 max-h-[200px] overflow-y-auto text-xs",codeBlockProps:kn,hideCopy:!0,hideLanguage:!0,children:r}),s.length>we&&t.jsx("div",{className:"flex items-center justify-center rounded-b bg-[#f9fafb] p-2 dark:bg-[#1f2937]",children:t.jsxs(v,{variant:"tiny",color:"light",children:["Content truncated at ",Math.round(we/1024),"KB (original size: ",Math.round(s.length/1024),"KB)"]})})]})})});zt.displayName="McpToolOutput";const Ht=C.memo(({step:e,action:s})=>{const{final:o}=e.content,n=!o;return t.jsx(G,{text:s,icon:Qs,isLoading:n,size:"tiny",pill:!0})});Ht.displayName="PdfStep";const Xe=["start","end"],$t=C.memo(({attachments:e,attachmentProcessingProgress:s})=>{const{$t:o}=O(),c=e.filter(f=>Ts(f)).length+s.length,r=e.length+Xe.length,l=Math.min(c/r*100,100),a=s.filter(f=>!f.success),d=i.useMemo(()=>!!s.filter(f=>f.file_url==="end").length,[s]),m=i.useCallback(f=>{const S=Rs(f.file_url??"");let g;switch(f.error_code){case"token_limit_exceeded":g=o({defaultMessage:"{filename} exceeds the model's token limit.",id:"60iyTByOrX"},{filename:S});break;case"file_type_not_supported":g=o({defaultMessage:"{filename} is of an unsupported file type. It will not be included in the results.",id:"sB9AI6thAL"},{filename:S});break;case"no_data_received":g=o({defaultMessage:"{filename} has timed out.",id:"/wyRgEWdz7"},{filename:S});break;default:g=o({defaultMessage:"{filename} could not be read. It will not be included in the results.",id:"7w0MjjvHs3"},{filename:S});break}return g},[o]),_=i.useMemo(()=>{const f=a.map((g,j)=>t.jsx(Re,{icon:Vs,text:m(g)},j)),S=t.jsx(Re,{icon:Js,text:o({defaultMessage:"Successfully read {numAttachments} attached files.",id:"5VxFwE1ux3"},{numAttachments:c-a.length-Xe.length})});return[...f,...d?[S]:[]]},[a,o,c,d,m]);return t.jsx(je,{className:"pt-md pb-xs px-xs !border-[#32B8C6]",children:t.jsx(ce,{maxHeight:250,autoScroll:!1,children:t.jsxs("div",{className:"pr-md gap-x-md flex w-full",children:[t.jsx(v,{className:"bg-super flex size-8 flex-none items-center justify-center rounded-md border-[0.75px] border-[#05FFFF]/20 shadow-[0px_1px_4px_0px_rgba(0,0,0,0.24)]",children:t.jsx(W,{icon:Xs,size:"md",className:"text-inverse"})}),t.jsxs("div",{className:"gap-y-xs flex grow flex-col",children:[t.jsx(v,{variant:"smallBold",children:o({defaultMessage:"Reading {numAttachments} attached {numAttachments, plural, one {file} other {files}}",id:"BqiTCbmvgp"},{numAttachments:e.length})}),t.jsx("div",{className:"h-2 w-full rounded-[37px] bg-[#60584D]/[0.06]",children:t.jsx("div",{className:"h-2 rounded-[37px] bg-[#32B8C6] transition-all duration-300",style:{width:`${l}%`}})}),t.jsxs("div",{className:"pt-xs",children:[t.jsx(Z,{items:_,vertical:!0,truncate:!1}),!d&&t.jsx(et,{variant:"super",active:!d,as:"span",className:"pt-xs",children:t.jsx(v,{variant:"small",color:"super",children:o({defaultMessage:"Reading...",id:"IvE1kfOWAz"})})})]})]})]})})})});$t.displayName="PendingFilesStep";const Re=C.memo(({icon:e,text:s})=>t.jsxs("div",{className:"py-xs gap-x-sm flex",children:[t.jsx(v,{className:"flex items-center justify-center",children:t.jsx(W,{icon:e,size:"sm"})}),t.jsx(v,{variant:"small",color:"light",children:s})]}));Re.displayName="PendingFilesItem";const qt=C.memo(({user:e,onRemove:s})=>{const o=i.useCallback(()=>{s(e)},[s,e]);return t.jsxs("div",{className:"border-subtlest gap-two pr-three flex h-8 items-center justify-between rounded-lg border pl-1.5 font-sans shadow-sm",children:[t.jsxs("div",{className:"gap-xs px-xs flex min-w-0 flex-row text-left",children:[t.jsx(v,{variant:"small",as:"span",children:e.display_name}),t.jsx(v,{variant:"small",color:"light",className:"truncate",as:"span",children:e.email_address})]}),t.jsx($,{variant:"common",size:"tiny",onClick:o,icon:_e,extraCSS:"rounded-md","aria-label":`Remove ${e.display_name}`})]})});qt.displayName="UserPill";const Wt=C.memo(({goalId:e,foundUsers:s,names:o,sendStepResult:n})=>{const{$t:c}=O(),[r,l]=i.useState([]),a=i.useRef(null);i.useEffect(()=>{a.current&&a.current.focus()},[]);const d=i.useCallback(h=>{const y=h.map(N=>({...N,selected:!0}));l(y)},[]),m=i.useCallback(async()=>{await n({goal_id:e,selected_users:r,submitted:!0},"User selected contacts and clicked continue",!1)},[e,r,n]),_=i.useCallback(h=>{ye.isEnterKeyWithoutShift(h.nativeEvent)&&r.length>0&&(h.preventDefault(),m())},[r.length,m]),f=i.useMemo(()=>({chooseContacts:c({defaultMessage:"Confirm or change contacts",id:"j4L7Bt/R+D"}),moreContacts:c({defaultMessage:"More contacts...",id:"XqmjEIgTyk"}),pickContacts:c({defaultMessage:"Pick contacts...",id:"dAWwl8XInO"}),continue:c({defaultMessage:"Confirm",id:"N2IrpMDHDB"}),skip:c({defaultMessage:"Skip",id:"/4tOwTiCH6"})}),[c]),S=i.useMemo(()=>(s??[]).map(h=>({type:"default",text:h.display_name??"",description:h.email_address??"",active:r.some(y=>y.email_address===h.email_address),preserveRightElementSpace:!0,onClick:()=>{const y=r.some(N=>N.email_address===h.email_address);d(y?r.filter(N=>N.email_address!==h.email_address):[...r,h])}})),[s,r,d]);i.useEffect(()=>{if(s&&s.length>0&&r.length===0){const h=s.filter(y=>y.selected);if(h.length>0)d(h);else{const y=Math.min(o?.length||1,s.length);d(s.slice(0,y))}}},[s]);const g=i.useCallback(h=>{d(r.filter(y=>y.email_address!==h.email_address))},[r,d]),j=i.useCallback(async()=>{await n({goal_id:e,selected_users:s,submitted:!1},"User clicked skip",!1)},[s,e,n]);return t.jsxs(As,{ref:a,className:"py-2 pt-4 outline-none",onKeyDown:_,tabIndex:0,children:[t.jsxs("div",{className:"gap-md flex flex-col px-4",children:[t.jsx(v,{variant:"smallBold",children:f.chooseContacts}),t.jsxs("div",{className:"gap-sm flex flex-wrap items-stretch",children:[r.map(h=>t.jsx(qt,{user:h,onRemove:g},h.email_address)),r.length<(s?.length??0)&&t.jsx(Ds,{items:S,isMobileStyle:!1,placement:"bottom-start",children:t.jsx(G,{variant:"border",size:"small",icon:Zs,"aria-label":r.length===0?f.moreContacts:f.pickContacts})})]})]}),t.jsxs("div",{className:"gap-sm mt-4 flex items-center px-4 py-2",children:[t.jsx(G,{size:"small",variant:"inverted",text:f.continue,disabled:r.length===0,onClick:m}),t.jsx($,{size:"small",text:f.skip,onClick:j})]})]})});Wt.displayName="PickContactsStep";const Tn=e=>{const[s,o]=i.useState([]),n=i.useRef(e);i.useEffect(()=>{n.current=e},[e]);const c=i.useCallback((a,d)=>{o(m=>{const _=[...m];return _[a]=d,_})},[]),r=i.useMemo(()=>new Map,[]);i.useEffect(()=>{const a=s.reduce((d,m)=>d+m,0);a>0&&n.current?.(a)},[s]);const l=i.useCallback(a=>(r.has(a)||r.set(a,d=>{c(a,d)}),r.get(a)),[r,c]);return i.useMemo(()=>({groupCounts:s,handleGroupCountChange:c,getGroupHandler:l}),[s,c,l])},Yt=C.memo(({result:e,textClassName:s})=>{const o=i.useMemo(()=>e.start?new Date(e.start):null,[e.start]),n=i.useMemo(()=>e.end?new Date(e.end):null,[e.end]),c=e.is_all_day===!0,r=ln(e.calendar_color?.background||"oklch(var(--super-color))"),l=cn(r),a=i.useMemo(()=>n?new Date(n.getTime()-24*60*60*1e3):null,[n]),d=()=>o?c?(n?Math.round((n.getTime()-o.getTime())/864e5):1)<=1?t.jsx(Se,{startDate:o,endDate:o,isAllDay:!0,showDate:!0,includeYear:!1}):t.jsx(Se,{startDate:o,endDate:a,isAllDay:!0,showDate:!0,includeYear:!1}):t.jsx(Se,{startDate:o,endDate:n||o,isAllDay:!1,showDate:!0,includeYear:!1}):null;return t.jsx("div",{className:"hover:bg-offset dark:hover:bg-offsetPlus relative flex min-w-0 cursor-pointer gap-3 rounded-lg px-2 py-1.5",children:t.jsxs("div",{className:"flex gap-2",children:[t.jsx("div",{className:"py-xs relative w-1",children:t.jsx("div",{className:L("shrink-none top-two bottom-two absolute w-1 self-stretch rounded-full",{"brightness-[0.8]":l==="Fail"}),style:{backgroundColor:r}})}),t.jsxs("div",{className:"gap-two flex min-w-0 flex-1 flex-col",children:[t.jsx("div",{className:"flex min-w-0 items-center justify-between gap-2",children:e.title&&t.jsx(v,{variant:"smallBold",className:"shrink-0",as:"span",children:e.title})}),t.jsx("div",{className:"flex min-w-0 items-center gap-2",children:o&&t.jsx(v,{className:L("min-w-0 shrink text-ellipsis",s),variant:"tinyMono",color:"light",as:"span",children:d()})})]})]})})});Yt.displayName="CalendarResult";const Rn=e=>{const s=e.match(/^(.+?)\s*<(.+)>$/);return s?s[1].trim().replace(/^["']|["']$/g,"")||s[2].trim():e.trim().replace(/^["']|["']$/g,"")},An=e=>{const s=Date.now(),o=new Date(e),n=s-o.getTime();if(n<0)return"";const c=1e3*60,r=c*60,l=r*24,a=l*7,d=l*30,m=l*365;return n<c?"1m":n<r?`${Math.floor(n/c)}m`:n<l?`${Math.floor(n/r)}h`:n<a?`${Math.floor(n/l)}d`:n<d?`${Math.floor(n/a)}w`:n<m?`${Math.floor(n/d)}mo`:`${Math.floor(n/m)}y`},Kt=C.memo(({result:e,textClassName:s,icon:o})=>{const n=o?t.jsx(W,{icon:o,size:"xs"}):t.jsx("img",{src:Is,alt:"Gmail",className:"size-[16px]"}),c=e.date?An(e.date):null;return t.jsxs("div",{className:"hover:bg-offset dark:hover:bg-offsetPlus relative flex min-w-0 cursor-pointer gap-3 rounded-lg px-2 py-1.5",children:[t.jsx("span",{className:"mt-two shrink-0",children:n}),t.jsxs("div",{className:"gap-two flex min-w-0 flex-1 flex-col",children:[t.jsx("div",{className:"flex min-w-0 items-center justify-between gap-2",children:e.sender&&t.jsx(v,{variant:"smallBold",className:"shrink-0",as:"span",children:Rn(e.sender)})}),t.jsx("div",{className:"flex min-w-0 items-center gap-2",children:e.subject&&t.jsx(v,{className:L("min-w-0 shrink text-ellipsis font-medium",s),variant:"small",as:"span",children:e.subject})}),t.jsxs("div",{className:"flex min-w-0 items-center gap-2",children:[e.snippet&&t.jsx(v,{variant:"tinyMono",className:"min-w-0 shrink truncate",color:"light",as:"span",children:e.snippet}),c&&t.jsx(v,{variant:"tinyMono",className:"shrink-0 text-right",color:"light",as:"span",children:c})]})]})]})});Kt.displayName="EmailSearchResult";const Qt=C.memo(({result:e,textClassName:s,icon:o})=>{const n=o?t.jsx(W,{icon:o,size:"xs"}):t.jsx(W,{icon:en,size:"xs"}),c=("display_name"in e?e.display_name:void 0)||("name"in e?e.name:void 0)||"",r=("email_address"in e?e.email_address:void 0)||("url"in e?e.url:void 0)||"";return t.jsxs("div",{className:"hover:bg-offset dark:hover:bg-offsetPlus relative flex min-w-0 cursor-pointer items-center gap-3 rounded-lg px-2 py-1.5",children:[t.jsx("span",{className:"shrink-0",children:n}),t.jsxs("span",{className:"gap-xs flex min-w-0 items-center",children:[c&&t.jsx(v,{className:L("min-w-0 shrink text-ellipsis",s),variant:"small",as:"span",children:c||(r?r.split("@")[0]:"")}),r&&t.jsx(v,{variant:"tinyMono",className:"mt-px min-w-0 shrink truncate",color:"light",as:"span",children:r})]})]})});Qt.displayName="UserInfoSearchResult";const Vt=C.memo(({result:e,textClassName:s,icon:o})=>{const n=rt(e.url),c=it(e,n),r=o?t.jsx(W,{icon:o,size:"xs"}):t.jsx(ie.Icon,{url:e.url,isAttachment:e.is_attachment||!1,connectionType:n,isMemory:e.is_memory||!1,isConversationHistory:e.is_conversation_history||!1,isClientContext:e.is_client_context||!1,isInlineAttachment:!1}),l=e.url?t.jsx(ie.Source,{url:e.url,source:c,isAttachment:e.is_attachment||!1,connectionType:n,isMemory:e.is_memory||!1,isConversationHistory:e.is_conversation_history||!1,snippet:e.snippet}):null,a=e.is_memory?e.snippet:e.name;return t.jsxs("div",{className:"hover:bg-offset dark:hover:bg-offsetPlus relative flex min-w-0 cursor-pointer items-start gap-3 rounded-lg px-2 py-1.5",children:[t.jsx("div",{className:"mt-two shrink-0",children:r}),t.jsxs("div",{className:"gap-xs flex min-w-0 flex-1 items-center",children:[t.jsxs("div",{className:"flex min-w-0 flex-1 flex-col",children:[a&&t.jsx(v,{className:L("min-w-0 shrink text-ellipsis",s),variant:"small",as:"span",children:a}),e.is_conversation_history&&t.jsx(v,{variant:"tinyMono",color:"light",className:"pt-two line-clamp-1",children:e.snippet})]}),!e.is_conversation_history&&t.jsx(v,{variant:"tinyMono",className:L("mt-px shrink-0 lowercase"),color:"light",as:"span",children:l})]})]})});Vt.displayName="WebSearchResult";const Dn=({heading:e,groupIndex:s})=>t.jsxs(t.Fragment,{children:[s>0&&t.jsx("div",{className:"border-subtlest border-b"}),t.jsx(w,{variant:"raised",className:"-mx-xs pl-sm pb-sm sticky top-0 z-30 flex items-center gap-3 pt-3",children:t.jsx(v,{variant:"tinyMono",children:e})})]}),V=C.memo(({onClick:e,stepDelay:s,isFinished:o,results:n,textClassName:c,groupBy:r,onCountChange:l,icon:a,resultType:d="web",maxHeight:m=250})=>{const{getGroupHandler:_}=Tn(l),f=le(),S=lt(),g=i.useCallback(y=>{(y.is_memory||y.is_conversation_history)&&S(y)},[S]),j=i.useCallback(y=>N=>{if("is_conversation_history"in y){if(y.is_conversation_history||y.is_memory){N.preventDefault(),g(y);return}if(y.is_attachment||y.is_memory)return N.preventDefault();Le(N)&&(N.preventDefault(),f.openTab({url:y.url,tabId:y.tab_id}))}if(d==="email"||d==="calendar"){if(e){N.preventDefault();const D="url"in y?y.url:"";e(D||"")}return}const k="url"in y?y.url:"";e?.(k||"")},[f,e,d,g]);if(!n||n.length===0)return null;let h=[];if(r){const y=n,N=new Map;y.forEach(E=>{const A=E.category;N.has(A)||N.set(A,[]),N.get(A).push(E)});const k={open_tab:{heading:"Opened tabs",icon:t.jsx(W,{icon:nn})},closed_tab:{heading:"Recently closed tabs",icon:t.jsx(W,{icon:sn})},history:{heading:"Browser history",icon:t.jsx(W,{icon:tn})}},D=N.size>1;h=Array.from(N.entries()).map(([E,A])=>{const R=k[E];return{heading:D?R?.heading||E:void 0,icon:D?R?.icon:void 0,results:A}})}else n.length>0&&"results"in n[0]?h=n.map(k=>({heading:k.heading,results:k.results})):h=[{results:[...n]}];return t.jsx(je,{children:t.jsx(ce,{maxHeight:m,autoScroll:!1,topGradientOffset:h.length>1?36:0,scrollContainerClassName:h.length===1?"pt-sm":void 0,children:t.jsx("div",{className:"flex flex-col gap-px",children:h.map((y,N)=>{const k=y.results.map((E,A)=>{const R="url"in E?E.url:"",u=()=>{const M={result:E,textClassName:typeof c=="function"?c(E):c,icon:a};switch(d){case"web":return t.jsx(Vt,{...M});case"userinfo":return t.jsx(Qt,{...M});case"email":return t.jsx(Kt,{...M});case"calendar":return t.jsx(Yt,{...M});default:return null}};return t.jsx(X,{className:"-ml-xs block",href:R||"#",target:"_blank",rel:"noopener nofollow",onClick:j(E),children:u()},`${N}-${R||A}-${A}`)}),D=_(N);return t.jsxs("div",{className:"mb-sm last:mb-0",children:[y.heading&&h.length>1&&t.jsx(Dn,{heading:y.heading,groupIndex:N}),t.jsx(Z,{items:k,stepDelay:s,isFinished:o,vertical:!0,truncate:!1,onCountChange:D})]},N)})})})})});V.displayName="SearchResultsListStep";const te=C.memo(({result:e,onClick:s,visualStyle:o,showName:n,className:c})=>{const r=le(),l=rt(e.url),a=it(e,l),d=lt(),m=i.useCallback(()=>{(e.is_memory||e.is_conversation_history)&&d(e)},[d,e]),_=i.useCallback(f=>{if(e.is_conversation_history||e.is_memory){f.preventDefault(),m();return}if(e.is_attachment||e.is_memory)return f.preventDefault();Le(f)&&(f.preventDefault(),r.openTab({url:e.url,tabId:e.tab_id})),s?.(e.url)},[r,s,e.is_attachment,e.is_memory,e.tab_id,e.url,m,e.is_conversation_history]);return t.jsx(X,{className:L("inline-block max-w-full",c),href:e.url,target:"_blank",rel:"noopener nofollow",onClick:_,children:t.jsx(w,{variant:"offset",bgHover:"offsetPlus",className:"py-xs rounded-lg pl-1.5 pr-2.5",children:t.jsx(ie,{variant:"tinyMono",className:L("!text-[0.7rem]",{"!line-through":o==="closedTab"}),url:e.url,name:n?e.name:void 0,isAttachment:e.is_attachment,connectionType:l,source:a,isMemory:e.is_memory,isConversationHistory:e.is_conversation_history})})})});te.displayName="SearchResultBubble";const In=C.memo(({onClick:e,webResults:s,initialDisplayCount:o=12,stepDelay:n,isFinished:c=!1})=>{const r=i.useMemo(()=>s.map(l=>t.jsx(Jt,{result:l,onClick:e},l.url)),[e,s]);return t.jsx("div",{className:"gap-sm flex flex-wrap",children:t.jsx(Z,{items:r,initialDisplayCount:o,stepDelay:n,isFinished:c})})});In.displayName="SearchResultsStep";const Jt=C.memo(({result:e,onClick:s})=>{const o=le(),n=i.useMemo(()=>({onClick(c){Le(c)&&(c.preventDefault(),o.openTab({url:e.url,tabId:e.tab_id}))}}),[o,e.tab_id,e.url]);return t.jsx(Os,{result:e,linkProps:n,children:t.jsx(te,{result:e,onClick:s})},e.url)});Jt.displayName="CitationHoverCardFactory";const On=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9-]*\.)+[A-Z]{2,}$/i;function ee(e){return typeof e!="string"?!1:On.test(e)}const Xt=C.memo(({email:e,onChange:s,onSend:o})=>{const{$t:n}=O(),c=e?.cc??[],r=e?.bcc??[],l=e?.to??[],[a,d]=i.useState(c.length>0),[m,_]=i.useState(r.length>0),f=i.useCallback((u,M)=>{s({...e,[u]:M})},[e,s]),S=()=>{(!c||c.length===0)&&(!r||r.length===0)&&(d(!1),_(!1))},g={to:n({defaultMessage:"To",id:"9j3hXO4Ojb"}),cc:n({defaultMessage:"Cc",id:"J1CYkLdqdy"}),bcc:n({defaultMessage:"Bcc",id:"qLl3P2UOlZ"}),addRecipient:n({defaultMessage:"Add recipient",id:"o2g2HQVmtC"}),subject:n({defaultMessage:"Subject",id:"LLtKhppiyE"}),writeMessage:n({defaultMessage:"Write your message...",id:"yoP6t+NY/q"})},j=i.useCallback(u=>{if(ee(u)){const M=e?.to??[];M.includes(u)||f("to",[...M,u])}},[e,f]),h=i.useCallback(u=>{const M=e?.to??[];f("to",M.filter(I=>I!==u))},[e,f]),y=i.useCallback((u,M)=>{if(ee(M)){const I=e?.to??[];f("to",I.map(P=>P===u?M:P))}},[e,f]),N=i.useCallback(u=>{const M=e?.cc??[];ee(u)&&!M.includes(u)&&f("cc",[...M,u])},[e,f]),k=i.useCallback(u=>{const M=e?.cc??[];f("cc",M.filter(I=>I!==u))},[e,f]),D=i.useCallback((u,M)=>{if(ee(M)){const I=e?.cc??[];f("cc",I.map(P=>P===u?M:P))}},[e,f]),E=i.useCallback(u=>{const M=e?.bcc??[];ee(u)&&!M.includes(u)&&f("bcc",[...M,u])},[e,f]),A=i.useCallback(u=>{const M=e?.bcc??[];f("bcc",M.filter(I=>I!==u))},[e,f]),R=i.useCallback((u,M)=>{if(ee(M)){const I=e?.bcc??[];f("bcc",I.map(P=>P===u?M:P))}},[e,f]);return t.jsx("div",{className:"dark:bg-offset",children:t.jsxs("div",{className:"px-2 pb-2",children:[t.jsxs("div",{className:"border-subtlest flex min-h-[40px] items-center border-b p-0",children:[t.jsx(v,{variant:"small",color:"light",className:"w-10 min-w-[32px] select-none",children:g.to}),t.jsx("div",{className:"flex-1",children:t.jsx(Ee,{tags:l.map(u=>({label:u,value:u})),isMobileUserAgent:!1,onAdd:j,onDelete:h,onEdit:y,placeholder:g.addRecipient,isVisible:!0})}),t.jsxs("div",{className:"gap-two ml-2 flex",children:[!a&&t.jsx("button",{type:"button",className:"hover:bg-subtler text-quiet rounded-lg px-2 py-1 font-sans text-sm",onClick:()=>d(!0),children:g.cc}),!m&&t.jsx("button",{type:"button",className:"hover:bg-subtler text-quiet rounded-lg px-2 py-1 font-sans text-sm",onClick:()=>_(!0),children:g.bcc})]})]}),a&&t.jsxs("div",{className:"border-subtlest flex min-h-[40px] items-center border-b p-0",children:[t.jsx(v,{variant:"small",color:"light",className:"w-10 min-w-[32px] select-none",children:g.cc}),t.jsx("div",{className:"flex-1",children:t.jsx(Ee,{tags:c.map(u=>({label:u,value:u})),isMobileUserAgent:!1,onAdd:N,onDelete:k,onEdit:D,placeholder:g.addRecipient,isVisible:!0})})]}),m&&t.jsxs("div",{className:"border-subtlest flex min-h-[40px] items-center border-b p-0",children:[t.jsx(v,{variant:"small",color:"light",className:"w-10 min-w-[32px] select-none",children:g.bcc}),t.jsx("div",{className:"flex-1",children:t.jsx(Ee,{tags:r.map(u=>({label:u,value:u})),isMobileUserAgent:!1,onAdd:E,onDelete:A,onEdit:R,placeholder:g.addRecipient,isVisible:!0})})]}),t.jsx("input",{id:"subject-input",type:"text",value:e?.subject,onChange:u=>f("subject",u.target.value),placeholder:g.subject,className:"border-subtlest text-foreground placeholder:text-quieter min-h-[40px] w-full border-0 border-b bg-transparent py-3 font-sans text-sm focus:outline-none focus:ring-0",style:{boxShadow:"none"},"aria-label":g.subject}),t.jsx("textarea",{value:e?.body,onChange:u=>f("body",u.target.value),placeholder:g.writeMessage,rows:8,className:"text-foreground placeholder:text-quieter w-full resize-none border-0 bg-transparent py-2 font-sans text-sm focus:outline-none focus:ring-0",style:{minHeight:"180px",boxShadow:"none"},"aria-label":g.writeMessage,onFocus:S})]})})});Xt.displayName="EmailCard";const Zt=C.memo(({emailAction:e,sendStepResult:s,isFinished:o})=>{const n="send-email-step",[c,r]=i.useState(o??!1),l=i.useMemo(()=>{if(e?.send)return e.send.email;if(e?.forward)return e.forward.email},[e]),[a,d]=i.useState(l),{$t:m}=O(),_=i.useMemo(()=>!!(a?.to&&a.to.length===0),[a]),f=i.useMemo(()=>m({defaultMessage:"Send",id:"9WRlF4R2gm"}),[m]),[S,g]=i.useState(""),[j,h]=i.useState(!1),y=i.useCallback(()=>{r(!0),s({confirmed:!1},n,!1)},[s,n]),N=i.useCallback((u,M)=>{!u&&(!M||!M.trim())||(r(!0),s({confirmed:u,...M&&{user_input:M.trim()},...a&&{email:a}},n,!1),!u&&M&&(h(!1),g("")))},[s,n,a]),k=i.useCallback(()=>N(!0),[N]),D=i.useCallback(()=>N(!1,S),[N,S]),E=i.useCallback(u=>{ye.isEnterKeyWithoutShift(u)&&(u.preventDefault(),D())},[D]),A=i.useCallback(()=>{h(!1),g("")},[]),R=i.useCallback(u=>{u.preventDefault(),h(!0)},[]);return c?t.jsx(B,{icon:Y,iconClassName:"text-super",text:m({defaultMessage:"Done",id:"JXdbo8Vnlw"})}):t.jsxs(w,{variant:"raised",className:"py-sm rounded-lg border",children:[a&&t.jsx(w,{className:"px-sm mb-sm",children:t.jsx(Xt,{email:a,onChange:d})}),j&&t.jsxs("form",{onSubmit:D,children:[t.jsx(w,{className:"px-md py-sm gap-4 border-t",children:t.jsx(ge,{isMobileStyle:!1,isMobileUserAgent:!1,placeholder:m({defaultMessage:"What would you like to change about this email?",id:"lrZrku1OFD"}),value:S,onChange:g,onKeyDown:E,minRows:3,className:"mt-sm !pl-3",autoFocus:!0})}),t.jsxs("div",{className:"gap-sm p-md flex items-center justify-between",children:[t.jsxs("div",{className:"gap-sm flex",children:[t.jsx(G,{size:"small",variant:"inverted",text:m({defaultMessage:"Continue",id:"acrOozm08x"}),type:"submit"}),t.jsx($,{variant:"negative",size:"small",text:m({defaultMessage:"Cancel",id:"47FYwba+bI"}),onClick:A})]}),t.jsx($,{size:"small",text:m({defaultMessage:"Skip",id:"/4tOwTiCH6"}),onClick:y})]})]}),!j&&t.jsx("form",{onSubmit:k,children:t.jsxs("div",{className:"gap-sm px-md py-sm mt-4 flex items-center justify-between",children:[t.jsxs("div",{className:"gap-sm flex",children:[t.jsx(G,{size:"small",variant:"inverted",text:f,type:"submit",disabled:_}),t.jsx(G,{size:"small",variant:"common",text:m({defaultMessage:"Refine email",id:"xTUBb7cWyO"}),onClick:R})]}),t.jsx($,{size:"small",text:m({defaultMessage:"Skip",id:"/4tOwTiCH6"}),onClick:y})]})})]})});Zt.displayName="SendEmailStep";const Un=({onSkip:e,onConfirm:s,disabled:o=!1,isLoading:n=!1,result:c=null})=>{const{$t:r}=O();return c!==null?t.jsx(w,{className:"bg-base border-t pt-4",children:t.jsx("div",{className:"text-quiet text-sm",children:c?.confirmed===!0?r({defaultMessage:"Task will be created",id:"+A0SHGFNa7"}):r({defaultMessage:"Task was skipped",id:"uRAWVsTn39"})})}):t.jsx(w,{className:"bg-base border-t pt-4",children:t.jsx("div",{className:"flex items-center justify-between gap-4",children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(G,{size:"small",variant:"primary",text:r(n?{defaultMessage:"Creating...",id:"mRL9Vh/e/Z"}:{defaultMessage:"Create Task",id:"4+iiEILSrA"}),onClick:s,disabled:o||n}),t.jsx($,{size:"small",text:r({defaultMessage:"Skip",id:"/4tOwTiCH6"}),onClick:e,disabled:o||n})]})})})},Ln=({result:e})=>{const{$t:s}=O();return e?.confirmed===!0?t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(Y,{size:14,className:"shrink-0 text-[#16a34a]",title:"Confirmed"}),t.jsx("span",{className:"text-xs font-medium leading-none text-[#16a34a] dark:text-[#4ade80]",children:s({defaultMessage:"Task confirmed",id:"oLLCmoruP6"})})]}):e?.confirmed===!1?t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(_e,{size:14,className:"text-negative shrink-0",title:"Skipped"}),t.jsx("span",{className:"text-negative text-xs font-medium leading-none",children:s({defaultMessage:"Task skipped",id:"uMaJWuUUvD"})})]}):null},es=C.memo(({sendStepResult:e,taskAction:s,stepUUID:o,isFinished:n=!1})=>{const{$t:c}=O(),{trackEvent:r}=Us(),l="router",a=i.useMemo(()=>{const k=s.expiry_date?new Date(s.expiry_date):void 0;return{trigger:{type:$e.SCHEDULED,schedule:Fn(s.schedule),expiryDate:k},query:{prompt:s.prompt||"",searchModel:s.model_preference||He.DEFAULT},status:"ACTIVE",notificationSettings:Ls}},[s]),[d,m]=i.useState(Ps(a??Fs())),[_,f]=i.useState(null),S="task_operation";i.useEffect(()=>{s&&!n&&r("task modal opened",{source:l})},[s,n,r,l]),se.error("TaskOperationStep rendered",{stepUUID:o,hasTaskAction:!!s,isFinished:n,taskAction:s,taskActionType:typeof s,taskActionKeys:s?Object.keys(s):[],source:l});const g=i.useMemo(()=>c({defaultMessage:"Create Task",id:"4+iiEILSrA"}),[c]),j=i.useCallback(k=>{f(k),k.confirmed?(r("task modal action",{source:l,action:"created"}),e({confirmed:!0,task_action:k.task_action},S,!1)):(r("task modal action",{source:l,action:"deleted"}),e({confirmed:!1},S,!1))},[e,S,r]),h=i.useCallback(()=>{j({confirmed:!1})},[j]),y=i.useCallback(()=>{const k={task_name:d.query?.prompt||"Untitled Task",prompt:d.query?.prompt,model_preference:d.query?.searchModel||He.DEFAULT,schedule:d.trigger.type===$e.SCHEDULED?Pn(d.trigger.schedule):void 0,expiry_date:s.expiry_date};j({confirmed:!0,task_action:k})},[d,j,s.expiry_date]),N=i.useCallback(k=>{m(k)},[]);return s?n?t.jsx(B,{icon:Y,iconClassName:"text-super",text:"Done"}):t.jsxs(w,{className:"bg-base overflow-hidden rounded-lg border",children:[t.jsxs("div",{className:"bg-offset flex items-center justify-between px-4 py-3",children:[t.jsx("h3",{className:"text-foreground text-sm font-medium",children:g}),t.jsx(Ln,{result:_})]}),t.jsx("div",{className:"bg-base p-4",children:t.jsx(Bs,{children:t.jsxs("div",{className:"flex flex-col gap-3",children:[t.jsx(Gs,{configuration:d,onConfigurationChange:N}),t.jsx(Un,{onSkip:h,onConfirm:y,disabled:n,result:_})]})})})]}):(se.error("TaskOperationStep received null/undefined taskAction - will not render",{stepUUID:o,taskAction:s,isFinished:n,source:l}),null)});es.displayName="TaskOperationStep";function Pn(e){const s=`${e.hour.toString().padStart(2,"0")}:${e.minute.toString().padStart(2,"0")}`;switch(e.kind){case"ONCE":return{one_time:{datetime:new Date(e.year,e.month,e.day,e.hour,e.minute).toISOString()}};case"DAILY":return{daily:{time:s}};case"WEEKLY":return{weekly:{time:s,day_of_week:(e.dayOfWeek+6)%7}};case"MONTHLY":return{monthly:{time:s,day_of_month:e.day}};case"YEARLY":return{yearly:{time:s,day_of_month:e.day,month_of_year:e.month+1}};case"WEEKDAYS":return{weekdays:{time:s}};default:return{daily:{time:s}}}}function Fn(e){if(!e)return z();if(e.one_time){const s=e.one_time.datetime;if(!s)return z();const o=new Date(s);return{kind:"ONCE",minute:o.getMinutes(),hour:o.getHours(),day:o.getDate(),month:o.getMonth(),year:o.getFullYear(),dayOfWeek:o.getDay()}}else if(e.daily){const s=e.daily.time;if(!s)return z();const[o,n]=s.split(":"),c=parseInt(o,10),r=parseInt(n,10);if(isNaN(c)||isNaN(r))return z();const l=new Date;return{kind:"DAILY",minute:r,hour:c,day:l.getDate(),month:l.getMonth(),year:l.getFullYear(),dayOfWeek:l.getDay()}}else if(e.weekly){const s=e.weekly.time,o=e.weekly.day_of_week;if(!s||o==null)return z();const[n,c]=s.split(":"),r=parseInt(n,10),l=parseInt(c,10);if(isNaN(r)||isNaN(l))return z();const a=(o+1)%7,d=new Date;return{kind:"WEEKLY",minute:l,hour:r,day:d.getDate(),month:d.getMonth(),year:d.getFullYear(),dayOfWeek:a}}else if(e.monthly){const s=e.monthly.time,o=e.monthly.day_of_month;if(!s||o==null)return z();const[n,c]=s.split(":"),r=parseInt(n,10),l=parseInt(c,10);if(isNaN(r)||isNaN(l))return z();const a=new Date;return{kind:"MONTHLY",minute:l,hour:r,day:o,month:a.getMonth(),year:a.getFullYear(),dayOfWeek:a.getDay()}}else if(e.yearly){const s=e.yearly.time,o=e.yearly.month_of_year,n=e.yearly.day_of_month;if(!s||o==null||n==null)return z();const[c,r]=s.split(":"),l=parseInt(c,10),a=parseInt(r,10);if(isNaN(l)||isNaN(a))return z();const d=new Date;return{kind:"YEARLY",minute:a,hour:l,day:n,month:o-1,year:d.getFullYear(),dayOfWeek:d.getDay()}}else if(e.weekdays){const s=e.weekdays.time;if(!s)return z();const[o,n]=s.split(":"),c=parseInt(o,10),r=parseInt(n,10);if(isNaN(c)||isNaN(r))return z();const l=new Date;return{kind:"WEEKDAYS",minute:r,hour:c,day:l.getDate(),month:l.getMonth(),year:l.getFullYear(),dayOfWeek:l.getDay()}}return z()}const Ae=C.memo(({question:e,sendStepResult:s,isFinished:o})=>{const n="user-clarification-step",[c,r]=i.useState(o??!1),[l,a]=i.useState(""),{$t:d}=O(),m=i.useCallback(()=>{r(!0),s({confirmed:!1,user_input:l.length>0?l:"The user chose to confirm with the information provided"},n,!1)},[l,s]),_=i.useCallback(()=>{r(!0),s({confirmed:!1},n,!1)},[s]),f=i.useCallback(S=>{ye.isEnterKeyWithoutShift(S)&&(S.preventDefault(),m())},[m]);return c?t.jsx(B,{icon:Y,iconClassName:"text-super",text:d({defaultMessage:"Done",id:"JXdbo8Vnlw"})}):t.jsx(w,{variant:"raised",className:"py-sm rounded-lg border",children:t.jsxs("form",{onSubmit:m,children:[e&&t.jsxs("div",{className:"px-md pt-sm",children:[t.jsx(v,{variant:"small",children:e}),t.jsx("div",{className:"gap-sm mt-3 flex items-center",children:t.jsx("div",{className:"grow",children:t.jsx(ge,{isMobileStyle:!1,isMobileUserAgent:!1,placeholder:d({defaultMessage:"Add details…",id:"GTIJ9uAEMf"}),value:l,onChange:a,onKeyDown:f,minRows:3,className:"!pl-3",autoFocus:!0})})})]}),t.jsxs("div",{className:"gap-sm px-md py-sm mt-4 flex items-center",children:[t.jsx(G,{size:"small",variant:"inverted",text:d({defaultMessage:"Continue",id:"acrOozm08x"}),type:"submit"}),t.jsx($,{size:"small",text:d({defaultMessage:"Skip",id:"/4tOwTiCH6"}),onClick:_})]})]})})});Ae.displayName="UserClarificationStep";const Bn=e=>e.toLowerCase().replace(/_/g," ").replace(/^\w/,s=>s.toUpperCase()),ts=e=>{const{searchMode:s,hasAnswer:o,result:n}=tt(),{submitQuery:c}=Ue(),r=s===zs.STUDIO,{$t:l}=O(),{step:a,onStepClick:d,isFinished:m,stepDelay:_,motionProps:f,isNested:S=!1,showAllNestedSteps:g=!0,isMissionControl:j=!1}=e,[h,y]=i.useState(void 0),N=`resuming-step:${e.step.uuid??""}`,[k,D]=i.useState(()=>{try{return Ce.getItem(N)==="1"}catch{return!1}});i.useEffect(()=>{try{D(Ce.getItem(N)==="1")}catch{D(!1)}},[N]);const E=i.useCallback(async(p,x,b=!1)=>{a.uuid&&await Hs({contextUUID:n?.context_uuid,stepUUID:a.uuid,result:p,reason:x}).then(T=>{if(T&&!b){Ce.setItem(N,"1"),D(!0);const F=n?{...n,status:"RESUMING"}:void 0;c({rawQuery:n?.query_str??"",existingEntryUUID:n?.backend_uuid,existingFrontendContextUUID:n?.context_uuid,frontendUUID:n?.frontend_uuid,promptSource:"user",resumingQuery:!0,resumeFromUuid:a.uuid,resumeFromPlaceholder:F,collection:null,newFrontendContextUUID:null})}})},[a.uuid,c,n,N]),A=i.useCallback(async()=>{await E({confirmed:!0},"thread-upsell-accepted",!0)},[E]),R=i.useCallback(async()=>{await E({confirmed:!1},"thread-upsell-dismissed",!0)},[E]),u=(p,x)=>{const b=oe[p]?.message;return x?l(b,x):l(b)},M=p=>{const x=[];let b=0;for(;b<p.length;){const T=p[b],F=p[b+1];T.step_type==="GET_FREEBUSY_RESPONSE"?b+=1:T.step_type==="GET_FREEBUSY"&&F?.step_type==="GET_FREEBUSY_RESPONSE"?(x.push({...T,get_free_busy_response_content:F.get_free_busy_response_content,originalEndIndex:b+1}),b+=2):(x.push({...T,originalEndIndex:b}),b+=1)}return x},I=hn(),P=a.assets&&a.assets.length>0?t.jsx("div",{className:"gap-sm my-sm flex flex-row flex-wrap",children:a.assets.map(p=>t.jsx(dn,{asset:p},p.uuid))}):null,K=a.step_type,U=a.content.should_show_upsell??!1,J=a.content.upsell_information,Fe=t.jsx(nt,{position:"router_steps",upsellInformation:J,inFlight:!m,stepUUID:a.uuid,backendUuid:J?.backend_uuid,isLastResult:!0,onAccept:A,onReject:R}),ne=(()=>{switch(K){case"SEARCH_WEB":return{title:u("search"),content:t.jsx(H,{queries:a.content.queries.map(p=>p.query),stepDelay:r?2:void 0,isFinished:m})};case"SEARCH_RESULTS":{let p=function(T){return T.length===0?"reviewing_sources":T.every(F=>F.is_memory)?x.length===1?"reviewing_memory":"reviewing_memories":T.every(F=>F.is_conversation_history)?"reviewing_conversation_history":x.length===1?"reviewing_source":"reviewing_sources"};const x=a.content.web_results;return{title:u(p(x)),count:x.length>1?h:void 0,content:x.length===0?t.jsx(B,{icon:qe,text:l({defaultMessage:"No sources found",id:"yWSiuEkfbY"})}):x.length===1?t.jsx(te,{result:x[0],showName:!0,onClick:d}):t.jsx(V,{onClick:d,results:x,stepDelay:r?2:void 0,isFinished:m,onCountChange:y})}}case"ENTROPY_REQUEST":return{content:t.jsx(Nt,{step:a,isFinished:m??!1,isMissionControl:j})};case"CODE":return{content:!P&&t.jsx(un,{action:u("working"),step:a})};case"PDF":return{content:!P&&t.jsx(Ht,{action:u("creating_pdf"),step:a})};case"CREATE_APP_RESULT":return{content:null};case"CREATE_CLIENT_APP":return{title:u("building_app"),content:t.jsx(v,{variant:"tinyMono",className:"!text-[0.68rem]",children:a.content.caption})};case"CREATE_CHART":return{title:u("creating_chart"),content:t.jsx(v,{variant:"tinyMono",className:"!text-[0.68rem]",children:a.content.caption})};case"GET_URL_CONTENT":{const p=a.content.pages;return{title:u(p.length>1?"getting_sources":"getting_source"),count:p.length>1?h:void 0,content:p.length===0?t.jsx(B,{icon:rn,text:l({defaultMessage:"No content found",id:"JlMgLJz0nd"})}):t.jsx("div",{className:"flex flex-wrap gap-2",children:p.map((x,b)=>t.jsx(te,{result:{name:"",snippet:"",is_attachment:!1,url:x.url},showName:!1,onClick:d},x.url||b))})}}case"CLARIFYING_QUESTIONS_OUTPUT":return a.content.clarification?{content:t.jsx(wt,{step:a})}:null;case"THOUGHT":return{title:u("thinking"),content:t.jsx(w,{variant:"offset",className:"py-xs inline-block rounded-lg px-2.5",children:t.jsx(v,{variant:"tinyMono",className:"!text-[0.68rem]",children:a.content.thought})})};case"URL_NAVIGATE":return{title:u("navigate"),content:t.jsx(H,{queries:a.content.urls})};case"BROWSER_OPEN_TAB_RESULTS":return{title:u("opening_tab"),content:(()=>{const p=[{name:a.content.tab.title,url:a.content.tab.url,snippet:"",is_attachment:!1,is_client_context:!0,tab_id:a.content.tab.id}];return p.length===1?t.jsx(te,{result:p[0],showName:!0,onClick:d}):t.jsx(V,{results:p})})()};case"BROWSER_CLOSE_TABS_RESULTS":{const p=a.content.tabs;return{title:u("closing_tabs"),content:p.length===0?t.jsx(H,{queries:[I.failedClosedTabs],icon:Ke}):t.jsx(V,{results:p.map(x=>({name:x.title,url:x.url,snippet:"",is_attachment:!1})),textClassName:x=>{const b="url"in x&&x.url,T="name"in x&&x.name;return b||T?"opacity-65 line-through decoration-subtle":""}})}}case"READ_GMAIL":{const p=a.content.queries?.length?a.content.queries:[I.allEmail];return{title:u("searching_gmail"),content:t.jsx(H,{queries:p,icon:ve})}}case"READ_GMAIL_RESPONSE":{const p=a.content;return{title:p?.authenticated?p?.count===0?I.emailsFound(0):u("reading_emails"):I.gmailNotAuthenticated,content:p.authenticated&&p.count>0&&p.results?t.jsx(V,{results:p.results,resultType:"email",onClick:d,stepDelay:_,isFinished:m,maxHeight:400}):null}}case"READ_CALENDAR":return{title:u("searching_calendar"),content:t.jsx(H,{queries:a.content.queries??[],icon:ve})};case"READ_CALENDAR_RESPONSE":return{title:a.content.authenticated?a.content.count===0?I.eventsFound(0):u("reading_events"):I.googleCalendarNotAuthenticated,content:a.content.authenticated&&(a.content.count??0)>0&&a.content.results?t.jsx(V,{results:a.content.results,resultType:"calendar",onClick:d,stepDelay:_,isFinished:m,maxHeight:400}):null};case"UPDATE_CALENDAR":return{title:u("scheduling"),isFinished:!0,content:a.content?.clarification?t.jsx(Ae,{isFinished:k,question:a.content.clarification,sendStepResult:E}):a.content?.operations?t.jsx(Et,{isFinished:k,calendarOperations:a.content.operations,sendStepResult:E}):null};case"UPDATE_CALENDAR_RESPONSE":return{title:u("scheduling"),isFinished:!0,content:(()=>{const p=a.content?.operations;return!p||p.length===0?t.jsx(B,{icon:Y,iconClassName:"text-super",text:"Done"}):t.jsx(Mt,{operations:p})})()};case"CREATE_TASKS":{const x=a.content?.task_action;return se.info("CREATE_TASKS step debug",{stepUuid:a.uuid,stepType:a.step_type,hasContent:!!a.content,hasTaskAction:!!x,stepContent:a.content,taskAction:x,isFinished:m}),x?{title:u("scheduling"),isFinished:!0,content:t.jsx(es,{taskAction:x,stepUUID:a.uuid??"",isFinished:m||k,sendStepResult:E})}:(se.error("CREATE_TASKS step missing task_action - will not render",{stepUuid:a.uuid,stepContent:a.content,contentKeys:a.content?Object.keys(a.content):[]}),null)}case"CREATE_TASKS_RESPONSE":return{title:u("scheduled"),isFinished:!0,content:t.jsx(B,{icon:Y,iconClassName:"text-super",text:"Done"})};case"SEND_GMAIL":return o?null:{title:u("emailing"),content:a.content?.clarification?t.jsx(Ae,{isFinished:k,question:a.content.clarification,sendStepResult:E}):a.content?t.jsx(Zt,{isFinished:k,emailAction:a.content.action,sendStepResult:E}):null};case"SEND_GMAIL_RESPONSE":return{title:u("emailing"),isFinished:!0,content:t.jsx(kt,{status:a.content?.status})};case"GMAIL_GCAL_AGENT_RESPONSE":return{title:a.content.authenticated?void 0:I.gmailNotAuthenticated,content:null};case"GMAIL_GCAL_AGENT":{const p=M(a.content.steps??[]),x=g?p:p.slice(-1);return{content:t.jsx(t.Fragment,{children:x.map(b=>{const T={step_type:b.step_type||"GMAIL_GCAL_AGENT",content:b.step_type==="GET_FREEBUSY"&&b.get_free_busy_response_content?{...b.get_free_busy_content,...b.get_free_busy_response_content}:b.get_free_busy_content??b.get_user_info_content??b.get_user_info_response_content??b.send_gmail_content??b.update_calendar_content??b.update_calendar_response_content??b.send_gmail_response_content??b.get_free_busy_response_content??b.read_calendar_content??b.read_calendar_response_content??b.read_gmail_content??b.read_gmail_response_content??{},uuid:b.uuid||"",assets:void 0},F=g?b.originalEndIndex<(a.content.steps?.length??0)-1:!1;return t.jsx(ts,{step:T,isFinished:F,isNested:S,onStepClick:d,showAllNestedSteps:g},b.uuid)})}),skipWrapper:!0}}case"TERMINATE":return{title:u("conclusion"),content:a.content.reason?t.jsx(w,{variant:"offset",className:"py-xs inline-block rounded-lg px-2.5",children:t.jsx(v,{variant:"tinyMono",className:"!text-[0.68rem]",children:a.content.reason})}):null};case"GENERATE_IMAGE":return{title:u("generating_images"),content:t.jsx(v,{variant:"tinyMono",className:"!text-[0.68rem]",children:a.content.prompt})};case"GENERATE_IMAGE_RESULTS":return{title:u("presenting_images"),content:!P&&t.jsx(Tt,{urls:a.content.image_results.map(p=>p.url)})};case"GENERATE_VIDEO":return{title:u("generating_images"),content:t.jsx(v,{variant:"tinyMono",className:"!text-[0.68rem]",children:a.content.prompt})};case"GENERATE_VIDEO_RESULTS":return{title:u("presenting_images"),content:!P&&t.jsx(At,{urls:a.content.video_results.map(p=>p.url??""),onClick:d})};case"BROWSER_GROUP_TABS":return{title:u("grouping_tabs"),content:a.content.payloads?.length>0?t.jsx("div",{className:"gap-sm flex flex-row flex-wrap",children:a.content.payloads.map((p,x)=>t.jsx(Te,{color:p.color,title:p.title??""},x))}):null};case"BROWSER_GROUP_TABS_RESULTS":return{content:a.content.success?null:t.jsx(B,{icon:Ke,text:I.couldNotFinish})};case"BROWSER_UNGROUP":return{title:u("ungrouping_tabs"),content:a.content.payload?.groups_metadata&&a.content.payload.groups_metadata.length>0?(()=>{const p=a.content.payload.groups_metadata.map((x,b)=>({name:x.title||`Group ${b+1}`,url:"",source:x.title||`Group ${b+1}`}));return p.length===1?t.jsx(H,{queries:a.content.payload.groups_metadata.map(x=>x.title||"Unnamed Group"),initialDisplayCount:3,icon:Ye}):t.jsx(V,{results:p,icon:Ye,textClassName:"opacity-65 line-through decoration-subtle"})})():null};case"BROWSER_SEARCH_TAB_GROUPS":return{title:u("searching_tab_groups"),content:t.jsx(H,{queries:a.content.payload?.queries?.length?a.content.payload.queries:[I.allTabGroups],icon:ve})};case"BROWSER_SEARCH_TAB_GROUPS_RESULT":return{title:u("reading"),content:a.content.results.length>0?t.jsx("div",{className:"gap-sm flex flex-row flex-wrap",children:a.content.results.map((p,x)=>t.jsx(Te,{color:p.color,title:p.title??""},x))}):null};case"GET_USER_INFO":{const p=a.content;if(!p||!p.names)return null;const x=p.found_users,b=x&&x.length>0,T=p.submitted;return{title:b&&!T?void 0:u("getting_user_info"),content:b&&!T?t.jsx(Wt,{goalId:p.goal_id??"",foundUsers:p.found_users,names:p.names,sendStepResult:E}):t.jsx(H,{queries:p.names,icon:on})}}case"GET_USER_INFO_RESPONSE":{const{submitted:p,selected_users:x}=a.content??{},b=x?.some(T=>T.selected===!0);return p&&x?{title:x?.some(T=>T.selected===!0)?u("selecting_contacts"):u("getting_contact_details"),content:x.length===0?t.jsx(H,{queries:[u("no_contacts_found")],icon:an}):x.length===1?t.jsx(H,{queries:x.map(T=>`${T.display_name||""} ${T.email_address?`(${T.email_address})`:""}`.trim()),icon:We}):t.jsx(V,{results:x.map(T=>({...T,url:T.email_address?`mailto:${T.email_address}`:void 0})),icon:We,resultType:"userinfo",textClassName:T=>{const F="email_address"in T?T.email_address:void 0,Q=x?.find(cs=>cs.email_address===F);return b&&Q?.selected===!1?"opacity-65 line-through decoration-subtle":""}})}:null}case"GET_FREEBUSY":{const p=a.content;return{title:u("getting_freebusy"),content:(()=>{const x=p.free_busy_response?.available_periods?.length??0;let b,T;return!p.authenticated&&m?(b=I.googleCalendarNotAuthenticated,T=de):x===0&&m?(b=I.noAvailabilityFound,T=de):x>0&&(b=I.availableTimesFound(x),T=Qe),b?t.jsx(B,{text:b,icon:T}):null})()}}case"GET_FREEBUSY_RESPONSE":return{title:u("getting_freebusy"),content:(()=>{const p=a.content.free_busy_response?.available_periods?.length??0;let x,b;return!a.content.authenticated&&m?(x=I.googleCalendarNotAuthenticated,b=de):p===0&&m?(x=I.noAvailabilityFound,b=de):p>0&&(x=I.availableTimesFound(p),b=Qe),x?t.jsx(B,{text:x,icon:b}):null})()};case"PENDING_FILES":return{content:t.jsx($t,{attachments:a.content.attachments,attachmentProcessingProgress:a.content.attachmentProcessingProgress})};case"SEARCH_BROWSER":{const p=a.content.queries?.filter(b=>b!=null&&b.trim()!=="")||[],x=p.length>0?p:a.content.browser_content_sources?.map(b=>b in oe?u(b):Bn(b))||[];return{title:u("searching_browser"),content:t.jsx(H,{queries:x,isFinished:m})}}case"SEARCH_BROWSER_RESULTS":return{title:u("reading_browser"),count:h,content:(()=>{const{open_tabs:p,recently_closed_tabs:x,history:b}=a.content,T=(p?.length||0)+(x?.length||0)+(b?.length||0);if(T===0)return t.jsx(B,{icon:qe,text:l({defaultMessage:"No sources found",id:"yWSiuEkfbY"})});if(T===1){const Q=p?.[0]||x?.[0]||b?.[0];return t.jsx(te,{result:{...Q},showName:!0,onClick:d})}const F=[];return p&&p.length>0&&F.push(...p.map(Q=>({...Q,category:"open_tab"}))),x&&x.length>0&&F.push(...x.map(Q=>({...Q,category:"closed_tab"}))),b&&b.length>0&&F.push(...b.map(Q=>({...Q,category:"history"}))),t.jsx(V,{onClick:d,results:F,groupBy:"category",stepDelay:r?2:void 0,isFinished:m,onCountChange:y})})()};case"MCP_TOOL_INPUT":{const p=a.content;return"authenticated"in p&&(p.authenticated===void 0||p.authenticated===null)?null:{title:(()=>{const x=a.content;return u("MCP_TOOL",{appName:x?.app?ut(x.app):l({id:"bTDpQ+Tk24",defaultMessage:"external service"})})})(),content:t.jsx(Gt,{step:a,isFinished:m})}}case"MCP_TOOL_OUTPUT":{const p=a.content;return{title:u("MCP_TOOL"),content:t.jsx(zt,{content:p.content||"",shouldRerunQuery:!!p.should_rerun_query})}}case"BLOCKING_CLARIFYING_QUESTIONS":{const p=a.content.clarifying_questions||[],x=a.content.clarifying_answers||[];return{title:"Additional Information Needed",content:t.jsx(mt,{questions:p,toolUuid:a.uuid,isFinished:m,answers:x})}}default:return null}})();if(!ne)return null;if(ne.skipWrapper)return U&&J?t.jsxs(t.Fragment,{children:[Fe,ne.content]}):ne.content;const{title:Be,content:ss,count:ns,isFinished:as}=ne,os=U&&J?!0:as??(m||k)??!1,Ne={key:a.uuid,initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"mt-1.5"},rs={...Ne,...f,className:f?.className?`${Ne.className} ${f.className}`:Ne.className},{key:is,...ls}=rs;return t.jsxs(xe.div,{...k?{}:ls,children:[Be&&t.jsx(Pe,{title:Be,isFinished:os,className:"mb-two",count:ns,showAnimation:k}),U&&J?Fe:ss,P]},is)};ts.displayName="StepRenderer";export{ts as S,Pe as a,Vn as p};
//# sourceMappingURL=StepRenderer-uSZQJEuo.js.map
